(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"404C":function(e,t,n){"use strict";(function(e){var a=i(n("Zx67")),o=i(n("kiBT")),l=i(n("OvRC")),c=i(n("pFYg")),s=i(n("C4MV")),r=i(n("woOf"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WapLogin=void 0;var d=r.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,s.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();t.setExtraInfo=S,t.wapLoginState=L,t.wapLoginDispatch=U;var p=n("U7vG"),g=E(p),f=n("Zfgq"),m=E(n("4GUf")),h=n("f2Hk"),v=n("4n+p"),C=n("5qLU"),w=n("nztU"),y=E(n("mtWM"));function E(e){return e&&e.__esModule?e:{default:e}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,c.default)(t))&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,c.default)(t)));e.prototype=(0,l.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o.default?(0,o.default)(e,t):e.__proto__=t)}n("cQc5");(0,h.actionAxios)("wapLoginIndex");var N=(0,h.concatPageAndType)("global"),T={uc_loginOrReg:function(e){return{url:C.UCENTER+"/login/quick_login_register?spm="+e,method:"post"}},uc_phoneExist:function(e){return{url:C.UCENTER+"/user/phone_"+e+"/exists"}},uc_sendCode:{url:C.UCENTER+"/mock/send_code",method:"post"},uc_loginByPwd:{url:C.UCENTER+"/login/phone",method:"post"},uc_geeInit:function(e){return{url:C.UCGEE+"/gee/getChallenge?addressIp="+e+"&appId="+C.UCAPPID+"&t="+(new Date).getTime()}},uc_geeVerify:{url:C.UCGEE+"/gee/verifyLogin",method:"post"}};function S(e,t,n){return{type:"ds-zc",httpcode:e,serviceCode:t,message:n}}var I=t.WapLogin=function(t){function n(e){_(this,n);var t=b(this,(n.__proto__||(0,a.default)(n)).call(this,e));return t.codeHandle=function(){t.setState({selCode:!0})},t.pwdHandle=function(){t.setState({selCode:!1})},t.state={selCode:!0,redirect_uri:t.props.redirect_uri,params:t.props,secretCode:""},t}return k(n,p.Component),u(n,[{key:"render",value:function(){var t=this.state,n=t.selCode,a=t.redirect_uri,o=t.params;return g.default.createElement("div",{"data-page":"wap-login",style:{minHeight:e(window).height()}},g.default.createElement("div",{className:"page-logo"},g.default.createElement("img",{src:"/src/img/user/trc-logo.png"})),g.default.createElement("div",{className:"c-tc"},g.default.createElement("div",{className:"login-method",onClick:this.codeHandle},g.default.createElement("span",null,"验证码登录"),g.default.createElement("div",{className:"split-line code",style:n?{background:"#e60a30"}:{}})),g.default.createElement("div",{className:"login-method",onClick:this.pwdHandle},g.default.createElement("span",null,"密码登录"),g.default.createElement("div",{className:"split-line pwd",style:n?{}:{background:"#e60a30"}}))),n?g.default.createElement(P,{changeLogin:this.props.changeLogin,params:o}):g.default.createElement(H,{changeLogin:this.props.changeLogin,redirect_uri:a}))}}]),n}(),P=function(t){function n(t){_(this,n);var o=b(this,(n.__proto__||(0,a.default)(n)).call(this,t));return o.checkTel=function(e){return/^1\d{10}$/.test(e)?(o.setState({telCorrect:!0}),!0):(m.default.MsgTip({msg:"请输入正确的手机号码"}),!1)},o.checkCode=function(e){return!!/^\d{4}$/.test(e)||(m.default.MsgTip({msg:"验证码不正确"}),!1)},o.loadCaptchas=function(e){y.default.request(T.uc_geeInit(e)).then(function(e){if(200===e.status){var t=e.data;initGeetest({gt:t.gt,challenge:t.challenge,offline:!t.success,new_captcha:t.serverStatus,product:"bind"},o.handlerEmbed),o.setState({serverStatus:t.serverStatus})}}).catch(function(e){console.log(e),m.default.MsgTip({msg:"服务器繁忙"})})},o.handlerEmbed=function(t){t.onError(function(){m.default.MsgTip({msg:"验证错误"})}).onSuccess(function(){var n=t.getValidate(),a=o.state.serverStatus,l=e("#tel").val().replace(/\s+/g,"");n||m.default.MsgTip({msg:"请完成验证"}),y.default.request(d({},T.uc_geeVerify,{data:{addressIp:l,appId:C.UCAPPID,challenge:n.geetest_challenge,validate:n.geetest_validate,seccode:n.geetest_seccode,serverStatus:a}})).then(function(e){e.data.body&&"success"===e.data.body.status?(o.setState({secretCode:e.data.body.secretCode}),o.nextHandle()):t.reset()}).catch(function(e){console.log(e),m.default.MsgTip({msg:"服务器繁忙"})})}),t&&o.setState({captchaObj:t})},o.nextHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=o.state,a=n.count,l=n.codeSend;if(!l){e(".get-code").addClass("countdown").removeClass("send-code"),o.setState({codeSend:!0}),o.timer=setInterval(function(){l=!0,0===--a&&(a=60,l=!1,clearInterval(this.timer),e(".get-code").addClass("send-code").removeClass("countdown")),this.setState({count:a,codeSend:l})}.bind(o),1e3);var c=o;y.default.request(d({},T.uc_sendCode,{data:{appId:C.UCAPPID,phone:t,usage:"QUICK_LOGIN_REGISTER"}})).then(function(e){var t=e.data;"200"===t.code?m.default.MsgTip({msg:"验证码已发送"}):m.default.MsgTip({msg:t.message})}).catch(function(e){console.log(e),m.default.MsgTip({msg:"服务器繁忙"})}),y.default.request(d({},T.uc_phoneExist(t),{params:{appId:C.UCAPPID}})).then(function(e){var t=e.data;"200"===t.code&&c.setState({isNew:!t.body})}).catch(function(){m.default.MsgTip({msg:"服务器繁忙"})})}},o.getCode=function(){var t=e("#tel").val().replace(/\s+/g,"");o.checkTel(t)&&(o.loadCaptchas(t),o.getCatcha())},o.getCatcha=function(){var e=o.state.captchaObj;e?e.verify():setTimeout(o.getCatcha,1e3)},o.changeHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#code").val().replace(/\s+/g,"");11===t.length&&n?o.setState({inputComp:!0}):o.setState({inputComp:!1})},o.loginHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#code").val().replace(/\s+/g,"");if(o.checkTel(t)&&o.checkCode(n)){var a=o.state,l=a.isNew,c=a.secretCode,s=o.props.params,r=s.redirect_uri,i=s.invite,u=s.from;"ecard_red_jr"===u&&l&&/^TRC_/gi.test(i)&&(i=""+parseInt(i.substring(4))/7),y.default.request(d({},T.uc_loginOrReg(c),{headers:{"X-Platform-Info":"H5"},data:{appId:C.UCAPPID,phone:t,phoneCode:n}})).then(function(e){var t=e.data,n=e.status;if(t.body.isNew){var a=S(n,t.code,t.message);sdk.storeUserId(t.body.userId),sdk.dispatch("click",document.getElementById("submit"),a)}"200"===t.code?(m.default.MsgTip({msg:"成功"}),(0,w.setCookie)("token",t.body.token),o.props.changeLogin(!0),r&&"ecard_red_jr"===u||!/\?/.test(r)?window.location.replace(r):/\?/.test(r)?window.location.replace(r+"&user="+(l?"new":"old")):f.browserHistory.goBack()):m.default.MsgTip({msg:t.message})}).catch(function(e){console.log(e),o.props.changeLogin(!1)})}},o.delHandle=function(t){e(t.target).prev().val("").focus(),o.setState({inputComp:!1})},o.onlyNum=function(){e("#tel").val(e("#tel").val().replace(/\D/g,"")),e("#code").val(e("#code").val().replace(/\D/g,""))},o.state={count:60,codeSend:!1,telCorrect:!1,inputComp:!1,isNew:!1},o}return k(n,p.Component),u(n,[{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var t=this.state,n=t.count,a=t.codeSend,o=t.inputComp,l=t.telCorrect,c=a?n+"s后重发":"获取验证码",s=e("#tel").val();return g.default.createElement("div",{className:"input-area"},g.default.createElement("div",{className:"input-info c-pr"},g.default.createElement("input",{type:"text",id:"tel",placeholder:"泰然城账号/手机号码",maxLength:"11",onChange:this.changeHandle,onKeyUp:this.onlyNum,onPaste:this.onlyNum}),g.default.createElement("img",{className:"del-icon "+(s?"":"c-dpno"),src:"/src/img/user/delete.png",onClick:this.delHandle})),g.default.createElement("div",{className:"input-info c-pr"},g.default.createElement("input",{type:"text",id:"code",placeholder:"请输入验证码",maxLength:"4",onChange:this.changeHandle,onKeyUp:this.onlyNum,onPaste:this.onlyNum}),g.default.createElement("span",{className:"get-code c-tc send-code",onClick:this.getCode,disabled:!(l&&a)},c)),g.default.createElement("input",{type:"button",className:"submit-btn c-tc",id:"submit",style:{background:o?"#353535":"#c9c9c9"},disabled:!o,value:"登录",onClick:this.loginHandle}))}}]),n}(),H=function(t){function n(t){_(this,n);var o=b(this,(n.__proto__||(0,a.default)(n)).call(this,t));return o.pwdToggle=function(){o.setState({showPwd:!o.state.showPwd})},o.checkTel=function(e){return/^1\d{10}$/.test(e.trim())?(o.setState({telCorrect:!0}),!0):(m.default.MsgTip({msg:"请输入正确的手机号码"}),!1)},o.checkPwd=function(e){return!0},o.changeHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#pwd").val().replace(/\s+/g,"");t?o.setState({tel:t}):o.setState({tel:""}),11===t.length&&n.length>=6?o.setState({inputComp:!0}):o.setState({inputComp:!1})},o.loginHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#pwd").val().replace(/\s+/g,"");if(o.checkTel(t)&&o.checkPwd(n)){var a=o.props.redirect_uri,l=o;y.default.request(d({},T.uc_loginByPwd,{data:{appId:C.UCAPPID,encryptFlag:!1,password:n,phone:t}})).then(function(e){var t=e.data;"200"===t.code?(m.default.MsgTip({msg:"登录成功"}),(0,w.setCookie)("token",t.body.token),l.props.changeLogin(!0),a?window.location.replace(a):window.history.go(-1)):m.default.MsgTip({msg:t.message})}).catch(function(e){var t=e.error;console.log(t),m.default.MsgTip({msg:"服务器繁忙"}),l.props.changeLogin(!1)})}},o.delHandle=function(t){e(t.target).prev().val("").focus(),o.setState({inputComp:!1})},o.onlyNum=function(){e("#tel").val(e("#tel").val().replace(/\D/g,""))},o.state={tel:"",showPwd:!1,inputComp:!1},o}return k(n,p.Component),u(n,[{key:"render",value:function(){var e=this.state,t=e.tel,n=e.showPwd,a=e.inputComp;return g.default.createElement("div",{className:"input-area"},g.default.createElement("div",{className:"input-info c-pr"},g.default.createElement("input",{type:"text",id:"tel",placeholder:"请输入手机号码/泰然城账号",maxLength:"11",onChange:this.changeHandle,onKeyUp:this.onlyNum,onPaste:this.onlyNum}),g.default.createElement("img",{className:"del-icon "+(t?"":"c-dpno"),src:"/src/img/user/delete.png",onClick:this.delHandle})),g.default.createElement("div",{className:"input-info c-pr"},g.default.createElement("input",{type:n?"text":"password",id:"pwd",placeholder:"请输入密码",maxLength:"20",onChange:this.changeHandle}),n?g.default.createElement("img",{className:"eye-open",src:"/src/img/user/eye-open.png",onClick:this.pwdToggle}):g.default.createElement("img",{className:"eye-close",src:"/src/img/user/eye-close.png",onClick:this.pwdToggle})),g.default.createElement("input",{type:"button",className:"submit-btn c-tc",style:{background:a?"#353535":"#c9c9c9"},disabled:!a,value:"登录",onClick:this.loginHandle}),g.default.createElement(f.Link,{to:"/forgetPwd"},g.default.createElement("div",{className:"forget-btn"},"忘记密码")))}}]),n}();function L(e,t){return d({},e.wapLoginIndex)}function U(e,t){return{changeLogin:function(t){e(N("changeLogin",{login:t}))}}}t.default=(0,v.connect)(L,U)(I)}).call(this,n("OOjC"))},cQc5:function(e,t,n){}}]);