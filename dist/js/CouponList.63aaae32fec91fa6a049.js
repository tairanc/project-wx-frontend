(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{bcSm:function(e,t,n){"use strict";(function(e){var a=u(n("Zx67")),o=u(n("kiBT")),s=u(n("OvRC")),i=u(n("pFYg")),l=u(n("C4MV")),c=u(n("woOf"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,d,p=c.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,l.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),m=n("U7vG"),h=M(m),g=(M(n("O27J")),n("Zfgq")),v=n("d2xe"),y=n("fw66"),_=(n("f2t5"),n("5qLU")),E=M(n("4GUf")),w=M(n("qAHI"));function M(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o.default?(0,o.default)(e,t):e.__proto__=t)}n("y+V2");var N={getCouponList:{url:_.WXAPI+"/promotion/getCouponList"},exchangeCoupon:{url:_.WXAPI+"/promotion/exchangeCode"}},k=(d=r=function(t){function n(e){b(this,n);var t=x(this,(n.__proto__||(0,a.default)(n)).call(this,e));return t.getMsg=function(e){t.setState({listUpdate:!1,page:2}),w.default.request(p({},N.getCouponList,{params:{status:e,page:1,page_size:10}})).then(function(n){var a=n.data.data.coupon;t.setState({couponData:a.data,hasMore:a.data.length>=10,update:!0,listUpdate:!0,type:e})}).catch(function(e){console.log(e),t.setState({sending:!1}),e.response&&401===e.response.data.code?g.browserHistory.replace("/login?redirect_uri=%2FcouponList"):E.default.MsgTip({msg:e.response.data.message||"服务器繁忙"})})},t.addMsg=function(e){t.setState({sending:!0}),w.default.request(p({},N.getCouponList,{params:{status:e,page:t.state.page,page_size:10}})).then(function(n){var a=n.data.data.coupon;t.setState({couponData:t.state.couponData.concat(a.data),hasMore:a.data.length>=10,sending:!1,type:e,page:t.state.page+1})}).catch(function(e){console.log(e),t.setState({sending:!1}),E.default.MsgTip({msg:e.response.data.message||"服务器繁忙"})})},t.hideModal=function(){t.setState({showStatus:!1})},t.state={couponData:[],update:!1,listUpdate:!1,type:1,showStatus:!1,page:2,hasMore:!0,sending:!1},t.showMsg="",t}return S(n,m.Component),f(n,[{key:"componentWillMount",value:function(){document.title="优惠券"}},{key:"componentDidMount",value:function(){this.getMsg(1)}},{key:"render",value:function(){var t=this.state,n=t.type,a=t.couponData,o=t.showStatus,s=t.hasMore,i=t.sending;return this.state.update?h.default.createElement("div",{"data-page":"coupon-list",style:{minHeight:e(window).height()}},h.default.createElement("section",{id:"coupon-list",ref:"coupon"},h.default.createElement(C,{fn:this.getMsg}),this.state.listUpdate?h.default.createElement(D,{fn:this.addMsg,data:a,type:n,hasMore:s,sending:i}):h.default.createElement(v.LoadingRound,null)),h.default.createElement(y.PopupTip,{active:o,onClose:this.hideModal,msg:this.showMsg})):h.default.createElement(v.LoadingRound,null)}}]),n}(),r.contextTypes={store:h.default.PropTypes.object,router:h.default.PropTypes.object},d);t.default=k;var C=function(t){function n(){return b(this,n),x(this,(n.__proto__||(0,a.default)(n)).apply(this,arguments))}return S(n,m.Component),f(n,[{key:"componentDidMount",value:function(){var t=this.props.fn;e(".coupon-nav li").click(function(n){if("active-one swiper-slide"===e(this).attr("class"));else{e(this).addClass("active-one").siblings().removeClass("active-one");var a=parseInt(e(".active-one").attr("id"));t(a)}})}},{key:"render",value:function(){return h.default.createElement("ul",{className:"coupon-nav c-c35 c-tc c-fs14"},h.default.createElement("li",{className:"active-one swiper-slide",id:"1"},"未使用"),h.default.createElement("li",{className:"swiper-slide",id:"0"},"已使用"),h.default.createElement("li",{className:"swiper-slide",id:"2"},"已过期"))}}]),n}(),T=function(t){function n(){b(this,n);var e=x(this,(n.__proto__||(0,a.default)(n)).call(this));return e.hideModal=function(){e.setState({showStatus:!1})},e.state={showStatus:!1},e.showMsg="",e}return S(n,m.Component),f(n,[{key:"componentWillMount",value:function(){this.setState({canExchange:!0})}},{key:"componentDidMount",value:function(){var t=this;e(".exchange input").on("input",function(t){e(this).val()?e(this).next().css({"background-color":"#e60a30"}):e(this).next().css({"background-color":"#c9c9c9"})}),e(".exchange button").click(function(){var n=e(".exchange input").val();""!=n&&t.state.canExchange&&(t.setState({canExchange:!1}),w.default.request(p({},N.exchangeCoupon,{params:{exchange_code:n,source:"exchange"}})).then(function(){t.setState({canExchange:!0}),e(".exchange input").val(""),E.default.MsgTip({msg:"兑换成功"}),setTimeout(function(){history.go(0)},1e3)}).catch(function(n){t.setState({canExchange:!0}),e(".exchange input").val(""),E.default.MsgTip({msg:n.response.data.message||"服务器繁忙"})}))})}},{key:"render",value:function(){var e=this.state.showStatus;return h.default.createElement("div",null,h.default.createElement("div",{className:"exchange"},h.default.createElement("input",{type:"text",placeholder:"请输入兑换码"}),h.default.createElement("button",null,"兑换")),h.default.createElement(y.PopupTip,{active:e,onClose:this.hideModal,msg:this.showMsg}))}}]),n}(),D=function(t){function n(){return b(this,n),x(this,(n.__proto__||(0,a.default)(n)).apply(this,arguments))}return S(n,m.Component),f(n,[{key:"componentDidMount",value:function(){var t=parseInt(e(".active-one").attr("id"));this.setState({type:t})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.type,a=e.fn,o=e.hasMore,s=e.sending,i=t.map(function(e,t){return h.default.createElement(I,{data:e,type:n,key:t})});return h.default.createElement("div",{className:"list-contrl"},1===n&&h.default.createElement(T,null),h.default.createElement("div",{className:"each-list"},t.length?i:h.default.createElement(P,null)),!!t.length&&h.default.createElement(L,{type:n,fn:a,hasMore:o,sending:s}))}}]),n}(),P=function(e){function t(){return b(this,t),x(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return S(t,m.Component),f(t,[{key:"render",value:function(){return h.default.createElement("div",{className:"no-coupon"},h.default.createElement("img",{src:"./src/img/evaluate/no-coupon.png"}))}}]),t}(),I=function(e){function t(e){b(this,t);var n=x(this,(t.__proto__||(0,a.default)(t)).call(this,e));return n.getDate=function(e){var t=new Date(1e3*parseInt(e));return t.getFullYear()+"."+(parseInt(t.getMonth())+1)+"."+t.getDate()},n.noUse=function(){n.showMsg="还未到使用时间哦~",n.setState({showStatus:!0})},n.hideModal=function(){n.setState({showStatus:!1})},n.getPrice=function(e){var t=(e=parseFloat(e)).toString().split(".");return 1==t.length?e=h.default.createElement("span",null,t[0],h.default.createElement("span",{className:"c-fs14"},".00")):t.length>1?e=t[1].length<2?h.default.createElement("span",null,t[0],h.default.createElement("span",{className:"c-fs14"},".",t[1],"0")):h.default.createElement("span",null,t[0],h.default.createElement("span",{className:"c-fs14"},".",t[1])):void 0},n.formateDate=function(e){var t=e.split(" ");return t[0].split("-").join("/").substring(2)+" "+t[1].substring(0,5)},n.getTime=function(e){return new Date(e.replace(/-/g,"/")).getTime()},n.state={showStatus:!1},n.showMsg="",n}return S(t,m.Component),f(t,[{key:"render",value:function(){var e=this.state.showStatus,t=this.props,n=t.data,a=t.type,o=this.formateDate(n.use_start_time),s=this.formateDate(n.use_end_time),i=this.getTime(n.current_time)>this.getTime(n.use_start_time),l=4===n.type?"/item?item_id="+n.item_id:"/searchResult?coupon_id="+n.coupon_id+(0===n.type&&3===n.shop_attr?"&type=biz":"");return h.default.createElement("div",{className:"each-coupon c-pr"},h.default.createElement("div",{className:1===a?n.isset_limit_money?"coupon-bg":"coupon-bg coupon-bg2":"coupon-bg coupon-bg3"},h.default.createElement("div",{className:"coupon-left c-fl"},h.default.createElement("h2",{className:1===a?n.isset_limit_money?"c-cdred":"c-cdyellow":"c-c999"},"¥ ",h.default.createElement("span",{className:String(parseInt(n.deduct_money)).length<4?" price-a ":" price-b ",style:{lineHeight:"46px"}},4===n.type?this.getPrice(n.deduct_money):parseInt(n.deduct_money))),h.default.createElement("p",{className:"c-c999"},4===n.type?"原价"+n.limit_money:"满"+(n.limit_money?parseFloat(n.limit_money):"")+"使用")),h.default.createElement("div",{className:"coupon-right c-fl "+(n.isset_limit_money?"":"coupon-right2")},h.default.createElement("p",{className:"c-c999 coupon-title"},h.default.createElement("span",{className:"c-fs16 c-c35"},["店铺券","跨店券","平台券","免单券"][n.type])),h.default.createElement("div",{className:"c-c999 c-pr title-txt"},n.apply_text,h.default.createElement("span",{className:"c-pa disc-dot"})),h.default.createElement("p",{className:"c-fs10 c-c999 c-fs10",style:{lineHeight:"14px",display:"block",paddingTop:"12px"}},o,"至",s))),h.default.createElement(y.PopupTip,{active:e,onClose:this.hideModal,msg:this.showMsg}),1===a&&h.default.createElement(g.Link,{to:l},h.default.createElement("div",{className:"use-coupon "+(1===a?n.isset_limit_money?"":"use-coupon2":"use-coupon3")},i?"去使用":"去查看")))}}]),t}(),L=function(t){function n(){return b(this,n),x(this,(n.__proto__||(0,a.default)(n)).apply(this,arguments))}return S(n,m.Component),f(n,[{key:"componentWillUnmount",value:function(){e(window).unbind("scroll.loadmore")}},{key:"componentDidMount",value:function(){var t=this.props.fn,n=parseInt(e(".active-one").attr("id")),a=this;e(window).bind("scroll.loadmore",function(){e(this).scrollTop()>e(".list-contrl").height()-e(window).height()&&a.props.hasMore&&!a.props.sending&&t(n)})}},{key:"render",value:function(){var e=this.props,t=e.hasMore,n=e.sending,a=e.type;return h.default.createElement("div",{className:"no-more"},h.default.createElement("div",{className:"line c-pr"}),h.default.createElement("div",{className:"txt c-c999 c-tc c-fs14"},t?n?"加载中...":"下拉加载更多":2===a?"仅保留90天内的记录":"别拉了，我是有底线的~"))}}]),n}()}).call(this,n("OOjC"))},"y+V2":function(e,t,n){}}]);