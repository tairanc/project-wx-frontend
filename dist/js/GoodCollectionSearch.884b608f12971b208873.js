(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{QyXG:function(e,t,a){"use strict";(function(e){var n=d(a("Zx67")),o=d(a("kiBT")),r=d(a("OvRC")),i=d(a("C4MV")),s=d(a("Zzip")),l=d(a("pFYg")),c=d(a("5QVw")),u=d(a("woOf"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SearchInput=void 0;var p,f=u.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},m="function"==typeof c.default&&"symbol"===(0,l.default)(s.default)?function(e){return void 0===e?"undefined":(0,l.default)(e)}:function(e){return e&&"function"==typeof c.default&&e.constructor===c.default&&e!==c.default.prototype?"symbol":void 0===e?"undefined":(0,l.default)(e)},h=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();t.goodCollectionSearchState=q,t.goodCollectionSearchDispatch=Q;var g=a("U7vG"),v=H(g),y=(H(a("O27J")),a("4n+p")),_=a("Zfgq"),w=O(a("P9l9")),E=(O(a("8obM")),a("d2xe")),b=a("f2Hk"),k=a("zpSi"),D=a("fw66"),S=H(a("BYKG"));a("HRAo");var N=H(a("6YRh")),C=H(a("4GUf")),P=a("f2t5"),T=a("qeJi");function O(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function H(e){return e&&e.__esModule?e:{default:e}}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,l.default)(t))&&"function"!=typeof t?e:t}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,l.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o.default?(0,o.default)(e,t):e.__proto__=t)}var F=(0,b.concatPageAndType)("goodCollectionSearch"),I=w,L={searchKey:"key",category_id:"category_id",page:"page",condition:"condition"},B=function(t){function a(e,t){j(this,a);var o=M(this,(a.__proto__||(0,n.default)(a)).call(this,e));return e.storeHomeRequest||(document.title="商品搜索"),o.state={topButtonState:!1},o}return U(a,g.Component),h(a,[{key:"componentWillMount",value:function(){if(this.props.setFilterUpdate(!1),"item"!=this.props.from){var e=this.props.location.query,t=e.key,a=e.category_id,n={searchKey:t=void 0!==t?decodeURIComponent(t):"",category_id:void 0!==a?Number(a):"",condition:"",page:1};this.props.dispatch(F("setSearch",{searchData:n}))}else this.props.setFrom("")}},{key:"componentWillReceiveProps",value:function(e){if(this.props.searchData!==e.searchData){var t=(0,u.default)({},e.searchData,{searchKey:e.searchData.searchKey}),a=e.init,n=this.props.filterUpdate;n||(this.changeUrl(e.searchData),this.props.setData(t,a,n))}}},{key:"componentDidMount",value:function(){this.props.windowHeight<e(window).height()&&this.props.setWindowHeight(e(window).height())}},{key:"componentDidUpdate",value:function(){N.default.init({offset:e(window).height(),throttle:1e3})}},{key:"componentWillUnmount",value:function(){this.props.setFilterUpdate(!0),e("body").css({overflowY:"",position:"static"}),e(window).unbind("scroll")}},{key:"changeUrl",value:function(e){var t="",a=location.href.split("?")[0];for(var n in e)e.hasOwnProperty(n)&&e[n]&&(t+="&"+L[n]+"="+("service"==n?this.formatSearchData(e[n]):e[n]));history.replaceState({},null,a+"?"+t.substr(1))}},{key:"formatSearchData",value:function(e){var t="",a={};if("object"==(void 0===e?"undefined":m(e))){for(var n in e)e.hasOwnProperty(n)&&(t+=e[n]?n+",":"");return t.substr(0,t.length-1)}if("string"==typeof e){for(var o=e.split(","),r=0;r<o.length;r++)a[o[r]]=1;return a}}},{key:"dropDown",value:function(e){var t=this.props,a=t.searchData,n=t.dispatch,o=t.currentPage,r=t.totalPage,i=t.load,s=t.goodsList;if(!i||!s||o>=r)return e.lock(),e.noData(),void e.resetload();(a=S.default.fromJS(a).toJS()).page=o+1,I.collection(a).then(function(t){if(0!=t.data.code)return e.lock(),e.noData(),void e.resetload();n(F("concatData",{result:t.data})),n(F("setCurrentPage",{current:o+1})),e.resetload();var a=t.data.data.page;a.current_page>=a.total_page&&(e.lock(),e.noData(),e.resetload())}).catch(function(t){console.error(t),e.resetload()})}},{key:"render",value:function(){var e=this.props,t=e.errorState,a=e.load,n=e.init,o=e.goodsList,r=e.setFrom,i=e.prompt,s=e.promptClose;return v.default.createElement("div",{id:"goodCollectionSearch","data-page":"good-collection-page",style:{minHeight:this.props.windowHeight}},v.default.createElement(V,this.props),n?t?v.default.createElement(E.NetError,null):a?o&&o.length?v.default.createElement(R,{goodsList:o,setFrom:r,scrollArea:window,dropDown:this.dropDown.bind(this)}):v.default.createElement(E.SearchNone,null):v.default.createElement(E.LoadingRound,null):"",v.default.createElement(K,{topButtonState:this.state.topButtonState}),v.default.createElement(D.PopupTip,{active:i.show,msg:i.msg,onClose:s}))}}]),a}(),V=function(e){function t(){return j(this,t),M(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return U(t,g.Component),h(t,[{key:"render",value:function(){var e=this.props,t=e.keyWord,a=e.setSearch,n=e.dispatch,o=e.setInit;return v.default.createElement("div",{className:"filter-condition",ref:"filterCondition"},v.default.createElement(x,{setSearch:a,value:t,dispatch:n,setInit:o}))}}]),t}(),x=t.SearchInput=function(e){function t(e){j(this,t);var a=M(this,(t.__proto__||(0,n.default)(t)).call(this,e));return a.searchSubmit=function(e){(e=void 0!==e?e.trim():"")?(a.props.setInit(!0),a.props.setSearch({searchKey:e})):a.props.dispatch(F("ctrlPrompt",{prompt:{show:!0,msg:"请输入搜索关键词"}}))},a.clearHandle=function(e){a.setState({innerValue:""})},a.changeValue=function(){a.setState({innerValue:a.refs.search.value})},a.state={innerValue:""},a}return U(t,g.Component),h(t,[{key:"componentDidMount",value:function(){var e=this.props.isMount;e&&e.call(this)}},{key:"render",value:function(){var e=this,t=this.state.innerValue;return v.default.createElement("form",{"data-comp":"search-bar-a",className:"g-row-flex",onSubmit:function(t){t.preventDefault(),e.searchSubmit(e.state.innerValue.trim())}},v.default.createElement("label",{className:"g-col-1 search-label",ref:"label"},v.default.createElement("input",{ref:"search",type:"search",placeholder:"商品名称",value:t,className:"search-input",onChange:this.changeValue}),t&&v.default.createElement("i",{ref:"clear",onTouchTap:this.clearHandle,className:"close-x-icon"}," "),v.default.createElement("i",{className:"search-icon"}," ")),v.default.createElement("button",{type:"submit",className:"search-btn"},"搜索"))}}]),t}(),R=(0,k.DropDownLoad)(p=function(t){function a(){return j(this,a),M(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return U(a,g.Component),h(a,[{key:"setMinListHeight",value:function(){document.getElementsByClassName("goods-list")[0].style.minHeight=e(window).height()-85+"px",document.getElementsByClassName("goods-list")[0].minHeight=e(window).height()-85+"px"}},{key:"componentDidMount",value:function(){this.setMinListHeight()}},{key:"render",value:function(){var e=this.props,t=e.goodsList,a=e.setFrom;return v.default.createElement("div",{className:"goods-list style2"},t.map(function(e,t){return v.default.createElement(J,{key:t,data:e,index:t,setFrom:a})}))}}]),a}())||p,J=function(e){function t(e){j(this,t);var a=M(this,(t.__proto__||(0,n.default)(t)).call(this,e));return a.tradeTypeObj={Domestic:{name:"国内贸易",style:"hide-tag"},Overseas:{name:"海外直邮",style:"yellow-tag"},Bonded:{name:"跨境保税",style:"blue-tag"},Direct:{name:"海外直邮",style:"yellow-tag"}},a}return U(t,g.Component),h(t,[{key:"showPromotionDetail",value:function(e){return e.map(function(e,t){return v.default.createElement("span",{className:"promotion-tag",key:t},e)})}},{key:"showCountDetail",value:function(e){return v.default.createElement("span",{className:"tips"},"仅剩",e,"件")}},{key:"showPriceDetail",value:function(e){return v.default.createElement("span",{className:"tips"},"比收藏时降价￥",(0,T.trimZero)(e))}},{key:"showTopTagsByLevel",value:function(e){var t="";return(t=e?e.is_new_group?"新人团":e.is_hot?"热销":e.is_new?"新品":"":"")?v.default.createElement("span",{className:"new-hot-tag"},t):""}},{key:"render",value:function(){var e=this.props.data,t=e.item_id,a=e.primary_image,n=e.title,o=e.sell_price,r=(e.old_price,e.item_tag),i=e.trade_type,s=e.status,l=e.promotion_detail,c=e.store,u=e.price_diff,d=e.deleted_at,p=30===s&&c.real>0,f=c.real,m=10==i?"Domestic":20==i?"Overseas":30==i?"Bonded":40==i?"Direct":"",h=l.promotion_tags?l.promotion_tags:"",g=l.promotion_price?l.promotion_price:o;return v.default.createElement("div",{className:"good-item",onClick:this.props.setFrom.bind(this,"item")},v.default.createElement(_.Link,{to:"/item?item_id="+t},v.default.createElement("div",{className:"good-image"},v.default.createElement("img",{className:"primary-image","data-echo":a?a+"_m.jpg":"/src/img/search/no-goods-image.png",src:"/src/img/icon/loading/default-watermark.png"}),p&&!d?"":v.default.createElement("img",{className:"no-goods-count-image",src:"/src/img/search/no-goods-count.png"}),p&&!d&&u>0?u>0?this.showPriceDetail(u):"":p&&!d&&f<=5?this.showCountDetail(f):""),v.default.createElement("div",{className:"good-content"},v.default.createElement("div",{className:"good-title"},n),v.default.createElement("div",{className:"good-price"},v.default.createElement("span",{className:"sell-price"},v.default.createElement("span",{className:"money-icon"},"￥"),(0,T.trimZero)(g))),v.default.createElement("div",{className:"good-bottom-tag"},m?v.default.createElement("span",{className:"trade-tag "+this.tradeTypeObj[m].style},this.tradeTypeObj[m].name):"",p&&!d&&h&&h.length?this.showPromotionDetail(h):"")),r&&v.default.createElement("div",{className:"good-top-tag"},v.default.createElement("img",{src:r.images.mb_square_img}))))}}]),t}(),K=function(e){function t(){return j(this,t),M(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return U(t,g.Component),h(t,[{key:"render",value:function(){return v.default.createElement("div",{className:"control-button"},this.props.topButtonState?v.default.createElement(W,null):"")}}]),t}(),W=function(e){function t(){return j(this,t),M(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return U(t,g.Component),h(t,[{key:"jumpToTop",value:function(){(0,P.scrollTo)(0,50)}},{key:"render",value:function(){return v.default.createElement("div",{className:"jump-top-button",onClick:this.jumpToTop.bind(this)},v.default.createElement("i",{className:"jump-top-icon"}))}}]),t}();function q(e){return f({},e.goodCollectionSearch)}function Q(e){return{dispatch:e,promptClose:function(){e(F("ctrlPrompt",{prompt:{show:!1,msg:""}}))},setFrom:function(t){e(F("setFrom",{from:t}))},setInit:function(t){e(F("setInit",{init:t}))},setFilterUpdate:function(t){e(F("setFilterUpdate",{filterUpdate:t}))},setWindowHeight:function(t){e(F("windowHeight",{windowHeight:t}))},setSearch:function(t){e(F("setSearch",{searchData:t}))},setData:function(t,a,n){e(F("isLoad",{load:!1})),I.collection(t).then(function(t){if(0!=t.data.code)return e(F("setInit",{init:!0})),void e(F("isError",{errorState:!0}));e(F("isError",{errorState:!1})),t.data.data&&(a||(e(F("setInitItem",{result:t.data})),e(F("setInit",{init:!0}))),e(F("setCurrentPage",{current:t.data.data.page?t.data.data.page.current_page:1})),e(F("setTotalPage",{total:t.data.data.page?t.data.data.page.total_page:1})),e(F("isLoad",{load:!0})),e(F("setData",{result:t.data,filterUpdate:n})))}).catch(function(t){e(F("setInit",{init:!0})),e(F("isError",{errorState:!0})),C.default.MsgTip({msg:t.message||t.response.data.message||"服务器繁忙"})})},toggleQuickSelect:function(t){e(F("toggleQuickSelect",{isQuickSelect:t}))}}}t.default=(0,y.connect)(q,Q)(B)}).call(this,a("OOjC"))}}]);