(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{"5MC1":function(e,t,n){"use strict";var o=s(n("Zx67")),a=s(n("kiBT")),r=s(n("OvRC")),i=s(n("pFYg")),c=s(n("C4MV")),u=s(n("woOf"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.LoginPopupModule=void 0;var l=u.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,c.default)(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=n("U7vG"),f=E(p),g=n("4n+p"),h=n("f2Hk"),m=n("qeJi"),v=n("nztU"),C=n("5qLU"),w=E(n("mtWM")),_=E(n("4GUf"));function E(e){return e&&e.__esModule?e:{default:e}}n("hHxV");var b={uc_phoneExist:function(e){return{url:C.UCENTER+"/user/phone_"+e+"/exists"}},uc_sendCode:{url:C.UCENTER+"/mock/send_code",method:"post"},uc_loginOrReg:function(e){return{url:C.UCENTER+"/login/quick_login_register?spm="+e,method:"post"}},uc_wxBind:{url:C.UCENTER+"/login/wechat/bind?platform=MEDIA_PLATFORM",method:"post"},uc_isLogin:{url:C.UCENTER+"/user"},uc_logout:{url:C.UCENTER+"/user/logout",method:"post"},setOpenId:{url:C.WXAPI+"/userBind"},uc_geeInit:function(e){return{url:C.UCGEE+"/gee/getChallenge?addressIp="+e+"&appId="+C.UCAPPID+"&t="+(new Date).getTime()}},uc_geeVerify:{url:C.UCGEE+"/gee/verifyLogin",method:"post"}},y=(0,h.concatPageAndType)("userLogin"),P=(0,h.concatPageAndType)("global"),S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||(0,o.default)(t)).call(this,e));return n.changePhone=function(e){var t=e.target.value;t.length>11||(n.setState({phone:t}),11===t.length?n.setState({canSend:!0}):n.setState({canSend:!1}),n.checkCanSure())},n.changeValidate=function(e){var t=e.target.value;t.length>4||(n.setState({validateCode:t}),n.checkCanSure())},n.clearPhone=function(){n.setState({phone:""}),n.checkCanSure()},n.clearValidate=function(){n.setState({validateCode:""}),n.checkCanSure()},n.checkTel=function(e){return/^1\d{10}$/.test(e)?(n.setState({telCorrect:!0}),!0):(_.default.MsgTip({msg:"请输入正确的手机号码"}),!1)},n.focusCtrl=function(e,t){n.setState(function(e,t,n){return t in e?(0,c.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e+"Focus",t))},n.checkCanSure=function(){setTimeout(function(){var e=n.state,t=e.phone,o=e.validateCode;11===t.length&&4===o.length?n.setState({canSure:!0}):n.setState({canSure:!1})},0)},n.loadCaptchas=function(e){w.default.request(b.uc_geeInit(e)).then(function(e){if(200===e.status){var t=e.data;initGeetest({gt:t.gt,challenge:t.challenge,offline:!t.success,new_captcha:t.serverStatus,product:"bind"},n.handlerEmbed),n.setState({serverStatus:t.serverStatus})}}).catch(function(e){console.log(e),_.default.MsgTip({msg:"服务器繁忙"})})},n.handlerEmbed=function(e){e.onError(function(){_.default.MsgTip({msg:"验证错误"})}).onSuccess(function(){var t=e.getValidate(),o=n.state,a=o.serverStatus,r=o.phone;t||_.default.MsgTip({msg:"请完成验证"}),w.default.request(l({},b.uc_geeVerify,{data:{addressIp:r,appId:C.UCAPPID,challenge:t.geetest_challenge,validate:t.geetest_validate,seccode:t.geetest_seccode,serverStatus:a}})).then(function(t){t.data.body&&"success"===t.data.body.status?(n.setState({secretCode:t.data.body.secretCode}),n.nextHandle()):(e.reset(),_.default.MsgTip({msg:t.data.message||"校验失败"}))}).catch(function(e){console.log(e),_.default.MsgTip({msg:"服务器繁忙"})})}),e&&n.setState({captchaObj:e})},n.nextHandle=function(){var e=n.state.phone;n.setState({sending:!0}),n.timer=setInterval(function(){var e=n.state.countDown;e>1?n.setState({countDown:e-1}):(clearInterval(n.timer),n.setState({sending:!1,countDown:60}))},1e3);var t=n.props.dispatch;w.default.request(l({},b.uc_phoneExist(e),{params:{appId:C.UCAPPID}})).then(function(e){var t=e.data;"200"!==t.code&&n.setState({phoneExist:t.body})}).catch(function(e){console.log(e)}),w.default.request(l({},b.uc_sendCode,{data:{appId:C.UCAPPID,phone:e,usage:"QUICK_LOGIN_REGISTER"}})).then(function(e){var n=e.data;"200"!==n.code&&t(y("ctrlPrompt",{prompt:!0,msg:n.message}))}).catch(function(e){throw console.log(e),t(y("ctrlPrompt",{prompt:!0,msg:"服务器繁忙"})),new Error(e)})},n.sendValidate=function(){var e=n.state.phone;n.checkTel(e)&&(n.loadCaptchas(e),n.getCatcha())},n.getCatcha=function(){var e=n.state.captchaObj;e?e.verify():setTimeout(n.getCatcha,1e3)},n.sendRegister=function(){n.setState({isRegister:!0});var e=n.state,t=e.phone,o=e.validateCode,a=e.phoneExist,r=e.secretCode,i=n.props,c=i.from,u=i.invite,s=n.props.dispatch;"ecard_red_jr"===c?w.default.request(l({},b.uc_loginOrReg(r),{headers:{"X-Platform-Info":"WECHAT"},data:{appId:C.UCAPPID,phone:t,phoneCode:o,inviteCode:u}})).then(function(e){var t=e.data;if("200"===t.code){var o=t.body.token;n.setState({isRegister:!1}),(0,v.setCookie)("token",o),s(P("changeLogin",{login:!0}));var r=a?"old":"new",i=decodeURIComponent(n.props.redirect_uri);i=/\?/.test(n.props.redirect_uri)?i+"&user="+r:i+"?user="+r;var c=n.props,u=c.ident,d=c.openId;w.default.request(l({},b.uc_wxBind,{headers:{Authorization:"Bearer "+o},params:{ident:u}})).then(function(e){var t=e.data;"200"===t.code?w.default.request(l({},b.setOpenId,{params:{openid:d}})).then(function(){window.location.replace(i)}).catch(function(e){console.log(e),window.location.replace(i)}):s(y("ctrlPrompt",{prompt:!0,msg:t.message}))}).catch(function(e){throw console.log("error",e),n.setState({isRegister:!1}),s(y("ctrlPrompt",{prompt:!0,msg:"服务器繁忙"})),(0,m.urlReplace)(i),new Error(e)})}else n.setState({isRegister:!1}),s(P("changeLogin",{login:!1})),s(y("ctrlPrompt",{prompt:!0,msg:t.message})),(0,m.urlReplace)(n.props.redirect_uri)}).catch(function(e){throw console.log(e),n.setState({isRegister:!1}),s(y("ctrlPrompt",{prompt:!0,msg:"服务器繁忙"})),(0,m.urlReplace)(redirect_uri),new Error(e)}):w.default.request(l({},b.uc_loginOrReg(r),{data:{appId:C.UCAPPID,phone:t,phoneCode:o,inviteCode:u}})).then(function(e){var t=e.data;if("200"===t.code){var o=t.body.token,a=n.props,r=a.ident,i=a.openId,c=a.redirect_uri;w.default.request(l({},b.uc_wxBind,{headers:{Authorization:"Bearer "+o},params:{ident:r}})).then(function(e){var t=e.data;if("200"!==t.code)return _.default.MsgTip({msg:t.message}),!1;(0,v.setCookie)("token",o),n.setState({isRegister:!1}),s(P("changeLogin",{login:!0})),w.default.request(l({},b.setOpenId,{params:{openid:i}})).then(function(){window.location.replace(c)}).catch(function(e){console.log(e),window.location.replace(c)})}).catch(function(e){throw console.log("error",e),n.setState({isRegister:!1}),s(y("ctrlPrompt",{prompt:!0,msg:"服务器繁忙"})),(0,m.urlReplace)(c),new Error(e)})}else n.setState({isRegister:!1}),s(P("changeLogin",{login:!1})),s(y("ctrlPrompt",{prompt:!0,msg:t.message}))}).catch(function(e){throw console.log(e),n.setState({isRegister:!1}),s(y("ctrlPrompt",{prompt:!0,msg:"服务器繁忙"})),(0,m.urlReplace)(redirect_uri),new Error(e)})},n.state={phone:"",validateCode:"",phoneFocus:!1,codeFocus:!1,canSend:!1,sending:!1,countDown:60,canSure:!1,isRegister:!1,secretCode:""},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a.default?(0,a.default)(e,t):e.__proto__=t)}(t,p.Component),d(t,[{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e=this,t=this.state,n=t.phone,o=t.validateCode,a=t.phoneFocus,r=t.codeFocus,i=t.canSend,c=t.sending,u=t.countDown,s=t.canSure,l=t.isRegister;return f.default.createElement("div",{"data-comp":"login-popup"},f.default.createElement("div",{className:"login-popup"},f.default.createElement("h3",null,"绑定手机更安全"),f.default.createElement("i",{className:"close-xa-icon",onClick:this.props.popupClose}," "),f.default.createElement("label",{className:"strip-grid phone-input"},f.default.createElement("div",{className:"icon-grid"},f.default.createElement("i",{className:"phone-shape-icon"}," ")),f.default.createElement("div",{className:"input-grid"},f.default.createElement("input",{type:"number",placeholder:"请输入手机号码",value:n,onInput:this.changePhone,onFocus:function(t){e.focusCtrl("phone",!0)},onBlur:function(t){return e.focusCtrl("phone",!1)}}),""!==n&&a&&f.default.createElement("i",{className:"close-x-icon",onTouchTap:this.clearPhone}," "))),f.default.createElement("div",{className:"strip-grid"},f.default.createElement("label",{className:"validate-grid"},f.default.createElement("div",{className:"icon-grid"},f.default.createElement("i",{className:"key-shape-icon"}," ")),f.default.createElement("div",{className:"input-grid"},f.default.createElement("input",{type:"number",placeholder:"短信验证码",value:o,onInput:this.changeValidate,onFocus:function(t){e.focusCtrl("code",!0)},onBlur:function(t){return e.focusCtrl("code",!1)}}),""!==o&&r&&f.default.createElement("i",{className:"close-x-icon",onTouchTap:this.clearValidate}," "))),f.default.createElement("div",{className:"send-validate "+(i&&!c?"active":""),onClick:i&&!c&&this.sendValidate},c?u+"秒后重发":"发送验证码")),f.default.createElement("div",{className:"login-btn-grid"},f.default.createElement("div",{className:"login-btn "+(s&&!l?"":"dis"),onClick:s&&!l&&this.sendRegister},"确认"))))}}]),t}();t.LoginPopupModule=(0,g.connect)()(S)},hHxV:function(e,t,n){},qBGu:function(e,t,n){"use strict";(function(e){var o=s(n("Zx67")),a=s(n("kiBT")),r=s(n("OvRC")),i=s(n("pFYg")),c=s(n("C4MV")),u=s(n("woOf"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=u.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,c.default)(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=n("U7vG"),f=b(p),g=(n("Zfgq"),n("4n+p")),h=n("5MC1"),m=n("fw66"),v=n("f2Hk"),C=n("qeJi"),w=n("nztU"),_=n("5qLU"),E=b(n("mtWM"));function b(e){return e&&e.__esModule?e:{default:e}}var y={uc_wx:{url:_.UCENTER+"/login/wechat"},uc_isLogin:{url:_.UCENTER+"/user"},setOpenId:{url:_.WXAPI+"/userBind"}},P=(0,v.concatPageAndType)("userLogin"),S=(0,v.concatPageAndType)("global"),I=function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}(this,(n.__proto__||(0,o.default)(n)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a.default?(0,a.default)(e,t):e.__proto__=t)}(n,p.Component),d(n,[{key:"componentWillMount",value:function(){this.props.getPower(),this.state={height:e(window).height()}}},{key:"render",value:function(){return f.default.createElement("div",null,this.props.showPopup&&f.default.createElement("div",{style:{height:this.state.height,overflow:"hidden",background:"rgba(0,0,0,0.5)"}},f.default.createElement(h.LoginPopupModule,this.props)),f.default.createElement(m.PopupTip,{active:this.props.prompt,msg:this.props.promptMsg,onClose:this.props.tipClose}))}}]),n}();t.default=(0,g.connect)(function(e,t){return l({},e.userLogin)},function(e,t){var n=t.location.query,o=n.redirect_uri,a=n.from,r=n.invite;return{redirect_uri:o=o||"/homeIndex",from:a,invite:r,getPower:function(){var n=t.location.query,a=n.code;n.state,a&&E.default.request(l({},y.uc_wx,{params:{code:a,appId:_.UCAPPID,returnBy:"JSON",platform:"MEDIA_PLATFORM"}})).then(function(t){var n=t.data;if("200"===n.code){var a=n.body,r=a.ident,i=a.token,c=a.extraInfo.openId;(0,w.setCookie)("openId",c),e(P("addIdentAndOpenid",{ident:r,openId:c})),n.body&&i?((0,w.setCookie)("token",i),e(P("addToken",{token:i})),e(S("changeLogin",{login:!0})),E.default.request(l({},y.setOpenId,{params:{openid:c}})).then(function(){window.location.replace(o)}).catch(function(e){console.log(e),window.location.replace(o)})):(e(S("changeLogin",{login:!1})),e(P("ctrlPopup",{status:!0})))}else e(S("changeLogin",{login:!1})),e(P("ctrlPrompt",{prompt:!0,msg:n.message||"服务器繁忙"})),(0,C.urlReplace)(o)}).catch(function(t){throw console.log(t),e(P("ctrlPrompt",{prompt:!0,msg:"服务器繁忙"})),new Error(t)})},popupClose:function(){window.history.go(-2)},tipClose:function(){e(P("ctrlPrompt",{prompt:!1,msg:""}))}}})(I)}).call(this,n("OOjC"))}}]);