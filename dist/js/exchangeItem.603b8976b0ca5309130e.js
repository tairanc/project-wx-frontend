(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{"5PJ1":function(e,t,n){},"8KRQ":function(e,t,n){"use strict";var a=u(n("Zx67")),i=u(n("kiBT")),r=u(n("OvRC")),o=u(n("pFYg")),l=u(n("C4MV")),c=u(n("woOf"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=c.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,l.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),p=n("U7vG"),d=N(p),f=n("d2xe"),h=n("6quk"),g=n("4n+p"),k=n("Zfgq"),v=n("f2Hk"),y=n("G/Ei"),_=N(n("B6QQ")),b=N(n("mtWM"));n("5PJ1");var E=n("5qLU"),w=n("f2t5");function N(e){return e&&e.__esModule?e:{default:e}}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}var P={init:{url:E.WXAPI+"/promotion/getExchangesList",method:"get"}},L=(0,v.concatPageAndType)("exchangeItem"),M=function(e){function t(){return x(this,t),C(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return I(t,p.Component),m(t,[{key:"componentWillMount",value:function(){this.props.initPage()}},{key:"componentWillUnmount",value:function(){y.loadMask.destroy(),h.tip.destroy()}},{key:"render",value:function(){var e=this.props.location.query.promotion_id,t=!!(this.props.data&&this.props.data[e]&&this.props.data[e].length);if(this.props.load)return d.default.createElement(f.LoadingRound,null);if(!t)return d.default.createElement(f.EmptyPageLink,{config:{bgImgUrl:"/src/img/activity/item-none-page.png",msg:"暂时没有活动商品",redBtn:!0,btnText:"返回",btnClick:function(){return k.browserHistory.goBack()}}});var n=this.props,a=n.limit,i=n.buyNum,r=n.fullPrice;return d.default.createElement("div",{"data-page":"exchange-item",style:{minHeight:this.props.winHeight}},d.default.createElement("div",{className:"m-header"},this.props.look?"购满"+r+"元可换购"+a+"件热销商品":"最多可换购"+a+"件，已选"+i+"件"),t?d.default.createElement(H,{data:this.props.data[e],look:this.props.look,itemCheck:this.props.itemCheck}):"",this.props.look?d.default.createElement("div",{className:"single-btn",onClick:this.props.toExchangeBuy},"去凑单"):d.default.createElement(B,{buyNum:i,limit:a,itemLength:t,look:this.props.look,onSubmit:this.props.submitHandle}))}}]),t}(),H=function(e){function t(){var e,n,i;x(this,t);for(var r=arguments.length,o=Array(r),l=0;l<r;l++)o[l]=arguments[l];return n=i=C(this,(e=t.__proto__||(0,a.default)(t)).call.apply(e,[this].concat(o))),i.getList=function(){return i.props.data.map(function(e,t){return d.default.createElement(q,{key:t,data:e,look:i.props.look,itemCheck:i.props.itemCheck.bind(i,t)})})},C(i,n)}return I(t,p.Component),m(t,[{key:"render",value:function(){return d.default.createElement("div",{className:"m-content"},this.getList())}}]),t}(),q=function(e){function t(){return x(this,t),C(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return I(t,p.Component),m(t,[{key:"render",value:function(){var e=this.props.data,t=e.store<=0||30!=e.shelf_status;return d.default.createElement("div",{className:"one-item g-row-flex "+(t&&"inv")},d.default.createElement("div",{className:"item-check"},d.default.createElement(_.default,{isCheck:e.check,invalid:t,disable:this.props.look,handleCheck:this.props.itemCheck})),d.default.createElement(k.Link,{className:"item-info g-col-1 g-row-flex",to:"/item?item_id="+e.item_id},d.default.createElement("div",{className:"item-img"},d.default.createElement("img",{src:e.image?(0,w.addImageSuffix)(e.image,"_t"):n("VM8K")}),e.store<=0?d.default.createElement("img",{className:"img-noItem",src:n("mhKy")}):""),d.default.createElement("div",{className:"item-detail g-col-1"},d.default.createElement("div",{className:"title"},e.title),d.default.createElement("div",{className:"props"},e.spec_text),d.default.createElement("div",{className:"item-price g-row-flex"},d.default.createElement("p",{className:"price"},"换购价 ¥",+e.price),+e.market_price?d.default.createElement("p",{className:"origin-price"},"原价",+e.sell_price):"",d.default.createElement("p",{className:"num g-col-1"},"×1")))))}}]),t}(),B=function(e){function t(){return x(this,t),C(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return I(t,p.Component),m(t,[{key:"render",value:function(){return d.default.createElement("div",{className:"total-ctrl c-clrfix"},d.default.createElement("div",{className:"c-fl"},"已选择",this.props.buyNum,"/",this.props.limit),d.default.createElement("div",{className:"red-btn c-fr",onClick:this.props.onSubmit},this.props.look||!this.props.itemLength?"返回":"确定"))}}]),t}();t.default=(0,g.connect)(function(e,t){var n=t.location.query.promotion_id,a=e.exchangeItem.data&&e.exchangeItem.data[n]?e.exchangeItem.data[n].filter(function(e,t){return e.check}).length:0;return s({},e.exchangeItem,e.global,{buyNum:a})},function(e,t){var n=t.location.query,a=n.promotion_id,i=n.look,r=n.fullPrice,o=n.limit,l=t.location;return l.pathname,l.search,{look:i,toExchangeBuy:function(){k.browserHistory.replace("/searchResult?promotion_id="+a)},initPage:function(){b.default.request(s({},P.init,{params:{promotion_id:a}})).then(function(t){var n={data:t.data.data,rules:{fullPrice:r,limit:o},promotionId:a};e(L("initData",{result:n}))}).catch(function(e){y.loadMask.destroy(),h.tip.show({msg:e.message||e.response.data.message||"小泰发生错误，请稍后再试~"}),console.log(e)})},itemCheck:function(t){return e(function(e,n){var i=n().exchangeItem;if(i.data[a].filter(function(e,n){return t===n?!e.check:e.check}).length>i.limit)return h.tip.show({msg:"您最多只能换购"+i.limit+"件"}),!0;e(L("itemSelect",{result:{index:t,promotionId:a}}))})},submitHandle:function(){k.browserHistory.goBack()}}})(M)}}]);