(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{"1GTC":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAMAAAC8EZcfAAACB1BMVEVHcEzk5OTk5OTj4+Pk5OTj4+Pj4+Pk5OTj4+Pk5OTl5eXm5ub////j4+Pk5OTn5+fMzMzj4+Pj4+Pk5OTk5OTj4+Pk5OTj4+P////k5OTk5OTk5OTU1NTj4+Pk5OTj4+Pi4uLk5OTj4+Pj4+Pf39/k5OTk5OTk5OTj4+Pk5OTj4+Pj4+P////i4uLj4+Ph4eHk5OTj4+Pj4+Pi4uLh4eHj4+Pk5OTk5OTk5OTj4+Pd3d3k5OTl5eXj4+Pk5OTj4+Pk5OTj4+Pk5OTk5OTh4eHj4+Pj4+Pi4uLj4+Pk5OTf39/k5OTj4+Po6Ojl5eXk5OTj4+Pj4+Pk5OTj4+Pj4+Pk5OTk5OTj4+Pl5eXj4+Pk5OTm5uba2trj4+Pi4uLi4uLk5OTr6+vj4+Pj4+Pk5OTk5OTj4+Pk5OTk5OTk5OTj4+Pj4+Pj4+Pk5OTl5eXk5OTk5OTj4+Pk5OTj4+P////k5OTk5OTk5OTk5OTj4+Pj4+Pl5eXk5OTk5OTj4+Pk5OTk5OTk5OTf39/j4+Pj4+Pj4+Pj4+Pk5OTk5OTs7Ozk5OTk5OTn5+fj4+Pj4+Pl5eXk5OTj4+Pj4+Pk5OTk5OTi4uLj4+Pj4+Pk5OTk5OTj4+Pk5OTk5OTj4+Pi4uLj4+Pi4uLk5OTk5OTk5OTj4+Pi4uLj4+Pl5eXl5eXj4+Pk5OTl5eXk5ORx6wBXAAAArHRSTlMA1PmW0uHM3WbwPBUD++8WBer8RE4lmPIByk1VBvUdlTX3z0oQqla9enxBZQI23hG+2JcSNJz67su8D9NPSUPpdc5gqyvVVCzxTAgweRcUVzfN0OhTE+3XKHGZMwccLQm3DbFe5Vjrh3t0s/3gtB7AfXBp7AQ5kaKsQktZc4Z3+MmFGIpcu4uPxw6bXyCUg2NhL/Ny0WTC3461jb+S4kiTRzH2rvQ+nj0yp6Q7IeIw7gAABPZJREFUeNrtm+dbE0kcgDeBgwSSQJKDEEhESuhCAKmCCNxJEdGzAKLneWc59exdr/fee+/9/SPvQ8CQ3WyymNnyPDfvJzIzz+TN7O7Mb2Z/KIpEIpFIJBKJRCKRSCQSiUQikayxJ3nUvi/3JYt9+dp00uizTfBzLnTlazP/JZ12+TUHqcvfqo5gs02Ct/jCSLPLfGOP34w/tMfQYxIaXLFFMEmRsYarXLTD7xDXDxtrWR6gyXq/+W6uGW37KcuVlgte4TPD81vlMkes9rsUp8N46yYC5RYLJkjoLzD3NBPf16xa69dB/JK67Or6ZbyHSz1eK4PGpiRhi/ABrqiKam4RWfuzx6U1/IpvrRS8Rve8yu9H3PfnkgqtobFlURSHr7Nb5VdEww/pj1kMPZrfZCJFJFV+q/zy08YCraGv0cKo5hP/TMbnrgHi4cwmWsOjyY8tE7ybaeP7g/hddZssV9m2uPo2v/2uLXaMoe8fIn9mq3CIoe9vZv/NXuUIwxsJvDf1Kh1gGLuDd5t+ta5hTbg+esqPIPynovXhrNu32K8M5dz2Vrhw9WiLx10IxzWe5furWfor9xBXuJjThIfVmEK1Nir+7vuf890EPXPquDZ2PtVfpHQDz4C/9IGJpHq8GBNy31YDBNqrMgq98FABfVa1BwCqRfiNA4yoH50CBRWlvBUQsTmr2QG0au6WggWVylZgR1fBgjuBoHa/WrigshgEdhYs+D5wVjFDUGkD6gsWPABUmSNYBUwWLBiAWcUcQcULgYI7AXrNEuwFRAgWmyVY/H8WvDM01OdoQRXvfbjiaMEtAV4cc7JgHeB+WL/+7TfeqbJVcO9STsPRlyBq7z243ZvDcDQKdFssuN3jecSg4WgUCNVZLHgQHjU2hqPDQOhZ+yfqrdkNm4eB0GknrCRZDVN++5yx1GUxbC7J4SdIcGJkYYvBtVhj2FMChFr0pveFkTNCRhD/QIWxYCFlWJvpp3OUXDHgR9AlBoIdxqKZDMOexwC/jl9HMNVzwYKlDQC454yFW9vShv25/GrdADSUFr7vrAw/BRCfMRYP3jdM+e3O3ulMHGA6LOiV4FgEVKkM+gHrmmH/JDCo4+ebBGbnxJ3a7W8AThqMqFOGyzn8lNeAhv0izxXPoYpHAtmX/7QhMHhIr0UUaBPppxybADZOh0cSiY/0B9wL4Nb1exyYeEKooNIH6E24ypNTnkxuA5xXFaajnxagT6yf0gns0qs8a+i8Mh397AI8ggX3AR/oVT5tSDD9UL0MnLZyBNsfYARFvwjc3D34KnDZY+U9eOyg6im+mkhM6Tcvg1xJOiY8xeeAYaPzYF5BJQosiPQrcwPvGj+bySd4EnCXifNLrcU3xAn6GoHImBi79WjmuCJOUDkuLppZjwdrc8SDN98qyaQXCKrKStrNiQeNRNTPG5oHL5gTUaf2JHtz7kk2u5KkznNE7UnOtLbl29W1hIwITmt2dW3JJZuOgPM+JPZs3KVgQadbThNUnw86TjDP2i0FpaAUnB4aKpITtXmCW4E3rRPc/Bv3mqkXnnslf99C3rg7PmfB8Vkf9dmP8pyTN7MTCPabIdgvJvPI8blbqey31xdFCy6OCMp+c37+oBI7YVYG5gkxGZhKzKwcVkF+iqI0mZEFLPRf42rC9Y1ecXLeRp08aolEIpFIJBKJRCKRSCQSiUQiSfMffhBcHxSNPQ8AAAAASUVORK5CYII="},"y+V2":function(e,t,n){},"ybF+":function(e,t,n){"use strict";(function(e){var a=p(n("mvHQ")),o=p(n("gRE1")),c=p(n("Zx67")),r=p(n("kiBT")),l=p(n("OvRC")),u=p(n("pFYg")),i=p(n("C4MV")),s=p(n("woOf"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=s.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,i.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),m=n("U7vG"),k=C(m),P=(C(n("O27J")),n("Zfgq")),T=n("4n+p"),O=n("f2Hk"),g=(n("d2xe"),n("8x+B")),h=(n("TB1E"),n("6quk")),j=(n("f2t5"),n("G0HZ")),v=n("5qLU"),y=C(n("qAHI"));function C(e){return e&&e.__esModule?e:{default:e}}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,u.default)(t))&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,u.default)(t)));e.prototype=(0,l.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}n("y+V2");var A={couponRecalculate:{url:v.WXAPI+"/order/applyCouponRecalculate",method:"post"}},w=(0,O.concatPageAndType)("orderConfirm"),B=function(t){function n(){return N(this,n),E(this,(n.__proto__||(0,c.default)(n)).apply(this,arguments))}return b(n,m.Component),f(n,[{key:"componentDidMount",value:function(){e(window).scrollTop(0)}},{key:"render",value:function(){var t=this,n=this.props.couponList,a=n.usable_coupons,o=n.unusable_coupons,c=this.props,r=c.couponSelect,l=c.changeItemModal,u=c.itemModal;return this.props.itemModal?(0,j.preventScroll)(!0):(0,j.preventScroll)(!1),k.default.createElement("div",{"data-page":"use-coupon",className:"use-coupon"},k.default.createElement("div",{style:{minHeight:e(window).height(),backgroundColor:"#f4f4f4",paddingTop:"10px"}},k.default.createElement("div",{className:"non-use-coupon",onClick:function(){t.props.onSelectCoupon(null)}},k.default.createElement("span",{className:"c-c35 c-fs16"},"不使用优惠券"),r.code?k.default.createElement("i",{className:"current-no-icon current-icon"}," "):k.default.createElement("i",{className:"current-green-icon current-icon"}," ")),k.default.createElement("div",{className:"coupon"},k.default.createElement("div",{className:"coupon-body"},k.default.createElement(M,{type:"val",usable_coupons:a,unusable_coupons:o,couponSelect:r,changeItemModal:l,itemModal:u,onSelectCoupon:this.props.onSelectCoupon})))))}}]),n}(),M=function(e){function t(e){N(this,t);var n=E(this,(t.__proto__||(0,c.default)(t)).call(this,e));return n.formateDate=function(e){var t=e.split(" ");return t[0].split("-").join("/").substring(2)+" "+t[1].substring(0,5)},n.getDetail=function(e,t,a){var c=a?e.isset_limit_money?"red":"yellow":"grey",r=n.props.couponSelect,l=!a&&(0,o.default)(e.apply_records);if(!a&&l.length>0){e.coupon_id;n.state.couponData.couponId=l}var u=new Date(e.use_start_time.replace(/-/g,"/")).getTime(),i=new Date(e.current_time.replace(/-/g,"/")).getTime();return k.default.createElement("div",{key:"coupon"+t},k.default.createElement("div",{className:"one-coupon g-row-flex "+c,style:a?{}:{marginBottom:0},onClick:function(){a&&n.props.onSelectCoupon({code:e.coupon_code,limit:+e.limit_money,desc:"4"===e.type?+e.discount_money:+e.deduct_money})}},k.default.createElement("div",{className:"left "+c},k.default.createElement("p",{className:"one"},"¥",k.default.createElement("b",null,"4"===e.type?"0.01":parseInt(e.deduct_money))),k.default.createElement("p",{className:"two"},"4"===e.type?"原价"+parseFloat(e.limit_money):"满"+e.limit_money+"使用")),k.default.createElement("div",{className:"right g-col-1"},k.default.createElement("p",{className:"coupon-name"},k.default.createElement("span",{className:c},"4"===e.type?"免单券":"0"===e.type?"店铺券":"1"===e.type?"跨店券":"平台券")),k.default.createElement("p",{className:"two"},"•  ",e.apply_text),k.default.createElement("p",null,n.formateDate(e.use_start_time),"至",n.formateDate(e.use_end_time))),a&&(r.code===e.coupon_code?k.default.createElement("i",{className:"current-green-icon current-icon"}," "):k.default.createElement("i",{className:"current-no-icon current-icon"}," "))),!a&&k.default.createElement("div",{className:"invalid-bottom"},k.default.createElement("span",{className:"left-msg c-fs12 c-cf55"},u>i?"优惠券未到使用时间":e.balance?"还差 ¥ "+parseFloat(e.balance)+" 可用该券":"订单中无可用商品")))},n.state={couponData:{}},n}return b(t,m.Component),f(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.usable_coupons,o=t.unusable_coupons,c=a&&a.map(function(t,n){return e.getDetail(t,n,!0)}),r=o&&o.map(function(t,n){return e.getDetail(t,n,!1)}),l=this.props.itemModal&&this.state.couponData.couponId.map(function(e,t){return k.default.createElement(j.OneItem,{key:t,data:e,val:!0,noLabel:!0})});return k.default.createElement("div",{className:"coupon-list"},this.props.itemModal&&k.default.createElement(g.NewModal,{isOpen:this.props.itemModal,title:"订单中可用商品",onClose:function(t){t.stopPropagation(),e.props.changeItemModal(!1)}},k.default.createElement("div",{className:"item-modal"},l,k.default.createElement("div",{className:"button-wrapper"},k.default.createElement("button",{className:"button",onClick:function(t){t.stopPropagation(),e.props.changeItemModal(!1)}},"确定")))),!(c.length+r.length)&&k.default.createElement("div",{className:"c-tc no-coupon"},k.default.createElement("img",{src:n("1GTC"),width:"100",height:"100"}),k.default.createElement("p",{className:"c-cc9 c-fs16 c-mt15"},"您没有相关优惠券哦")),c,!!r.length&&k.default.createElement("div",{className:"coupon-tip"},"本订单不可用的优惠券"),r)}}]),t}();t.default=(0,T.connect)(function(e,t){return d({},e.orderConfirm)},function(e,t){return{dispatch:e,changeItemModal:function(t){e(w("changeItemModal",{flag:t}))}}},function(e,t,n){n.location.query.item_id;var o=t.dispatch;return d({},e,t,n,{onSelectCoupon:function(e){e||(e={code:"",limit:"",desc:0}),o(function(t,n){var o=n().orderConfirm,c=(0,a.default)({amounts:o.initAmounts,cart:o.cart});y.default.request(d({},A.couponRecalculate,{data:{hbCodes:(0,a.default)(o.initRedPackets),couponCode:e.code,orderData:c}})).then(function(n){var a=n.data;t(w("initialDataUpdate",{data:a.data.amounts,cartTicket:a.data.cartTicket})),t(w("resetRedPacket",{data:a.data.hbList})),t(w("selectCoupon",{couponSelect:e})),P.browserHistory.goBack()}).catch(function(e){h.tip.show({msg:e.response.data.message||"服务器繁忙"}),console.error(e)})})}})})(B)}).call(this,n("OOjC"))}}]);