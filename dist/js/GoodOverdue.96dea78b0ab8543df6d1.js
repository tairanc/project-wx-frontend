(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{WR2m:function(e,t,a){"use strict";(function(e){var o=d(a("Zx67")),n=d(a("kiBT")),r=d(a("OvRC")),i=d(a("C4MV")),s=d(a("Zzip")),l=d(a("pFYg")),c=d(a("5QVw")),u=d(a("woOf"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SearchInput=void 0;var p,f=u.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},h="function"==typeof c.default&&"symbol"===(0,l.default)(s.default)?function(e){return void 0===e?"undefined":(0,l.default)(e)}:function(e){return e&&"function"==typeof c.default&&e.constructor===c.default&&e!==c.default.prototype?"symbol":void 0===e?"undefined":(0,l.default)(e)},m=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,i.default)(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}();t.goodOverdueState=K,t.goodOverdueDispatch=V;var g=a("U7vG"),v=T(g),y=(T(a("O27J")),a("4n+p")),w=a("Zfgq"),_=M(a("P9l9")),C=(M(a("8obM")),a("d2xe")),E=a("f2Hk"),b=a("zpSi"),k=a("fw66"),D=T(a("BYKG"));a("HRAo");var S=T(a("6YRh")),N=T(a("4GUf")),U=a("f2t5"),O=a("qeJi"),P=a("tnFR");function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function T(e){return e&&e.__esModule?e:{default:e}}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,l.default)(t))&&"function"!=typeof t?e:t}function H(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,l.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}var j=(0,E.concatPageAndType)("goodOverdue"),F=_,I={searchKey:"key",category_id:"category_id",page:"page",condition:"condition"},B=function(t){function a(e,t){L(this,a);var n=A(this,(a.__proto__||(0,o.default)(a)).call(this,e));return e.storeHomeRequest||(document.title="失效商品"),n.state={topButtonState:!1},n}return H(a,g.Component),m(a,[{key:"componentWillMount",value:function(){if(this.props.setFilterUpdate(!1),"item"!=this.props.from){var e=this.props.location.query,t=e.key,a=e.category_id,o=e.condition,n={searchKey:t=void 0!==t?decodeURIComponent(t):"",category_id:void 0!==a?Number(a):"",condition:o||"invalid",page:1};this.props.dispatch(j("setSearch",{searchData:n}))}else this.props.setFrom("")}},{key:"componentWillReceiveProps",value:function(e){if(e.goodListUpdate||this.props.searchData!==e.searchData){var t=(0,u.default)({},e.searchData,{searchKey:e.searchData.searchKey}),a=e.init,o=this.props.filterUpdate;this.changeUrl(e.searchData),this.props.setData(t,a,o),this.props.setGoodListUpdate(!1),this.props.dispatch(j("noSave",{noSave:!1}))}}},{key:"componentDidMount",value:function(){this.props.windowHeight<e(window).height()&&this.props.setWindowHeight(e(window).height())}},{key:"componentDidUpdate",value:function(){S.default.init({offset:e(window).height(),throttle:1e3})}},{key:"componentWillUnmount",value:function(){this.props.setFilterUpdate(!0),e("body").css({overflowY:"",position:"static"}),e(window).unbind("scroll")}},{key:"changeUrl",value:function(e){var t="",a=location.href.split("?")[0];for(var o in e)e.hasOwnProperty(o)&&e[o]&&(t+="&"+I[o]+"="+("service"==o?this.formatSearchData(e[o]):e[o]));history.replaceState({},null,a+"?"+t.substr(1))}},{key:"formatSearchData",value:function(e){var t="",a={};if("object"==(void 0===e?"undefined":h(e))){for(var o in e)e.hasOwnProperty(o)&&(t+=e[o]?o+",":"");return t.substr(0,t.length-1)}if("string"==typeof e){for(var n=e.split(","),r=0;r<n.length;r++)a[n[r]]=1;return a}}},{key:"dropDown",value:function(e){var t=this.props,a=t.searchData,o=t.dispatch,n=t.currentPage,r=t.totalPage,i=t.load,s=t.goodsList;if(!i||!s||n>=r)return e.lock(),e.noData(),void e.resetload();(a=D.default.fromJS(a).toJS()).page=n+1,F.collection(a).then(function(t){if(0!=t.data.code)return e.lock(),e.noData(),void e.resetload();o(j("concatData",{result:t.data})),o(j("setCurrentPage",{current:n+1})),e.resetload();var a=t.data.data.page;a.current_page>=a.total_page&&(e.lock(),e.noData(),e.resetload())}).catch(function(t){console.error(t),e.resetload()})}},{key:"render",value:function(){var e=this.props,t=e.errorState,a=e.load,o=(e.init,e.noSave),n=e.goodsList,r=e.setFrom,i=e.prompt,s=e.shady,l=e.promptClose,c=e.manage,u=e.toggleManage,d=e.ifChooseAll,p=e.changeChooseAll,f=e.delCount,h=e.toggleshady,m=e.toggledelCount,g=e.setGoodListUpdate;return v.default.createElement("div",{id:"goodOverdue","data-page":"good-collection-page",style:{minHeight:this.props.windowHeight}},t?v.default.createElement(C.NetError,null):a?o?v.default.createElement(C.EmptyPage,{config:{msg:"暂无失效商品哦~",btnText:"返回我的收藏",link:"/myCollection",bgImgUrl:"/src/img/collect/trcNOcollection.png"}}):v.default.createElement("div",{className:"goodWrap"},v.default.createElement(x,{goodsList:n,setFrom:r,scrollArea:window,dropDown:this.dropDown.bind(this),manage:c,changeChooseAll:p,ifChooseAll:d}),v.default.createElement(P.ManageGoods,{manage:c,toggleManage:u,ifChooseAll:d,changeChooseAll:p,delCount:f,shady:s,toggleshady:h,toggledelCount:m,setGoodListUpdate:g})):v.default.createElement(C.LoadingRound,null),v.default.createElement(W,{topButtonState:this.state.topButtonState}),v.default.createElement(k.PopupTip,{active:i.show,msg:i.msg,onClose:l}))}}]),a}(),R=(function(e){function t(){return L(this,t),A(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}H(t,g.Component),m(t,[{key:"render",value:function(){var e=this.props,t=e.keyWord,a=e.setSearch,o=e.dispatch,n=e.setInit;return v.default.createElement("div",{className:"filter-condition",ref:"filterCondition"},v.default.createElement(R,{setSearch:a,value:t,dispatch:o,setInit:n}))}}])}(),t.SearchInput=function(e){function t(e){L(this,t);var a=A(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.searchSubmit=function(e){(e=void 0!==e?e.trim():"")?(a.props.setInit(!0),a.props.setSearch({searchKey:e})):a.props.dispatch(j("ctrlPrompt",{prompt:{show:!0,msg:"请输入搜索词"}}))},a.clearHandle=function(e){a.props.value?a.props.onChange&&a.props.onChange(""):a.setState({innerValue:""})},a.state={innerValue:e.defaultValue},a}return H(t,g.Component),m(t,[{key:"componentDidMount",value:function(){var e=this.props.isMount;e&&e.call(this)}},{key:"render",value:function(){var e=this,t=this.props.value,a=this.state.innerValue;return v.default.createElement("form",{"data-comp":"search-bar-a",className:"g-row-flex",onSubmit:function(t){t.preventDefault(),e.searchSubmit(e.refs.search.value.trim())}},v.default.createElement("label",{className:"g-col-1 search-label",ref:"label"},v.default.createElement("input",{ref:"search",type:"search",placeholder:"商品名称/品牌",className:"search-input"}),""!==(void 0!==t?t:a)&&v.default.createElement("i",{ref:"clear",onTouchTap:this.clearHandle,className:"close-x-icon"}," "),v.default.createElement("i",{className:"search-icon"}," ")),v.default.createElement("button",{type:"submit",className:"search-btn"},"搜索"))}}]),t}()),x=(0,b.DropDownLoad)(p=function(t){function a(){return L(this,a),A(this,(a.__proto__||(0,o.default)(a)).apply(this,arguments))}return H(a,g.Component),m(a,[{key:"setMinListHeight",value:function(){document.getElementsByClassName("goods-list")[0].style.minHeight=e(window).height()-85+"px",document.getElementsByClassName("goods-list")[0].minHeight=e(window).height()-85+"px"}},{key:"componentDidMount",value:function(){this.setMinListHeight()}},{key:"render",value:function(){var e=this.props,t=e.goodsList,a=e.setFrom,o=e.manage,n=e.changeChooseAll,r=e.ifChooseAll;return v.default.createElement("div",{className:"goods-list style2"},t.map(function(e,t){return v.default.createElement(G,{key:t,data:e,index:t,setFrom:a,manage:o,changeChooseAll:n,ifChooseAll:r})}))}}]),a}())||p,G=function(t){function a(t){L(this,a);var n=A(this,(a.__proto__||(0,o.default)(a)).call(this,t));return n.changeChoose=function(t){var a=n.props.changeChooseAll,o=e(t.target),r=o.siblings(".shadyUnselect");r.hasClass("del-choose")?(r.removeClass("del-choose"),o.removeClass("del-shady")):(r.addClass("del-choose"),o.addClass("del-shady")),a(e(".good-item").length===e(".del-choose").length)},n.tradeTypeObj={Domestic:{name:"国内贸易",style:"hide-tag"},Overseas:{name:"海外直邮",style:"yellow-tag"},Bonded:{name:"跨境保税",style:"blue-tag"},Direct:{name:"海外直邮",style:"yellow-tag"}},n}return H(a,g.Component),m(a,[{key:"componentDidMount",value:function(){var t=this.props,a=t.manage,o=t.ifChooseAll;a&&o?e(".shadyUnselect").addClass("del-choose"):e(".shadyUnselect").removeClass("del-choose")}},{key:"showPromotionDetail",value:function(e){return e.map(function(e,t){return v.default.createElement("span",{className:"promotion-tag",key:t},e)})}},{key:"showCountDetail",value:function(e){return v.default.createElement("span",{className:"tips"},"仅剩",e,"件")}},{key:"showPriceDetail",value:function(e){return v.default.createElement("span",{className:"tips"},"比收藏时降价￥",(0,O.trimZero)(e))}},{key:"showTopTagsByLevel",value:function(e){var t="";return(t=e?e.is_new_group?"新人团":e.is_hot?"热销":e.is_new?"新品":"":"")?v.default.createElement("span",{className:"new-hot-tag"},t):""}},{key:"render",value:function(){var e=this.props.data,t=e.item_id,a=e.primary_image,o=e.title,n=e.sell_price,r=(e.old_price,e.trade_type),i=e.status,s=e.promotion_detail,l=e.store,c=e.price_diff,u=e.deleted_at,d=30===i&&l.real>0,p=l.real,f=10==r?"Domestic":20==r?"Overseas":30==r?"Bonded":40==r?"Direct":"",h=s.promotion_tags?s.promotion_tags:"",m=s.promotion_price?s.promotion_price:n,g=this.props.manage;return v.default.createElement("div",{className:"good-item",onClick:this.props.setFrom.bind(this,"item"),id:t},v.default.createElement(w.Link,{to:"/item?item_id="+t},v.default.createElement("div",{className:"good-image"},v.default.createElement("img",{className:"primary-image","data-echo":a?a+"_m.jpg":"/src/img/search/no-goods-image.png",src:"/src/img/icon/loading/default-watermark.png"}),d&&!u?"":v.default.createElement("img",{className:"no-goods-count-image",src:"/src/img/search/no-goods-count.png"}),d&&!u&&c>0?c>0?this.showPriceDetail(c):"":d&&!u&&p<=5?this.showCountDetail(p):""),v.default.createElement("div",{className:"good-content"},v.default.createElement("div",{className:"good-title"},o),v.default.createElement("div",{className:"good-price"},v.default.createElement("span",{className:"sell-price"},v.default.createElement("span",{className:"money-icon"},"￥"),(0,O.trimZero)(m))),v.default.createElement("div",{className:"good-bottom-tag"},f?v.default.createElement("span",{className:"trade-tag "+this.tradeTypeObj[f].style},this.tradeTypeObj[f].name):"",d&&!u&&h&&h.length?this.showPromotionDetail(h):""))),g&&v.default.createElement("div",{className:"shadyUnselect"}),g&&v.default.createElement("div",{className:"manageShady",onClick:this.changeChoose}))}}]),a}(),W=function(e){function t(){return L(this,t),A(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return H(t,g.Component),m(t,[{key:"render",value:function(){return v.default.createElement("div",{className:"control-button"},this.props.topButtonState?v.default.createElement(J,null):"")}}]),t}(),J=function(e){function t(){return L(this,t),A(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return H(t,g.Component),m(t,[{key:"jumpToTop",value:function(){(0,U.scrollTo)(0,50)}},{key:"render",value:function(){return v.default.createElement("div",{className:"jump-top-button",onClick:this.jumpToTop.bind(this)},v.default.createElement("i",{className:"jump-top-icon"}))}}]),t}();function K(e){return f({},e.goodOverdue)}function V(e){return{dispatch:e,promptClose:function(){e(j("ctrlPrompt",{prompt:{show:!1,msg:""}}))},setFrom:function(t){e(j("setFrom",{from:t}))},setInit:function(t){e(j("setInit",{init:t}))},setFilterUpdate:function(t){e(j("setFilterUpdate",{filterUpdate:t}))},setGoodListUpdate:function(t){e(j("setGoodListUpdate",{goodListUpdate:t}))},setWindowHeight:function(t){e(j("windowHeight",{windowHeight:t}))},setSearch:function(t){e(j("setSearch",{searchData:t}))},setData:function(t,a,o){e(j("isLoad",{load:!1})),F.collection(t).then(function(t){if(0!=t.data.code)return e(j("setInit",{init:!0})),void e(j("isError",{errorState:!0}));e(j("isError",{errorState:!1})),0==t.data.data.item_list.length&&e(j("noSave",{noSave:!0})),a||(e(j("setInitItem",{result:t.data})),e(j("setInit",{init:!0}))),e(j("setCurrentPage",{current:t.data.data.page?t.data.data.page.current_page:1})),e(j("setTotalPage",{total:t.data.data.page?t.data.data.page.total_page:1})),e(j("setData",{result:t.data,filterUpdate:o})),e(j("isLoad",{load:!0}))}).catch(function(t){e(j("setInit",{init:!0})),e(j("isError",{errorState:!0})),N.default.MsgTip({msg:t.message||t.response.data.message||"服务器繁忙"})})},toggleQuickSelect:function(t){e(j("toggleQuickSelect",{isQuickSelect:t}))},toggleManage:function(t){e(j("toggleManage",{manage:t}))},changeChooseAll:function(t){e(j("changeChooseAll",{ifchooseAll:t}))},toggledelCount:function(t){e(j("delCount",{delCount:t}))},toggleshady:function(t){e(j("shady",{shady:t}))}}}t.default=(0,y.connect)(K,V)(B)}).call(this,a("OOjC"))}}]);