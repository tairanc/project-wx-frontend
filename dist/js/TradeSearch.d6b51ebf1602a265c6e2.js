(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"67yC":function(e,t,a){"use strict";(function(e){var r=d(a("mvHQ")),o=d(a("Zx67")),n=d(a("kiBT")),l=d(a("OvRC")),s=d(a("pFYg")),c=d(a("C4MV")),i=d(a("woOf"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCtrl=t.OneListInfo=void 0;var u=i.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},p=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,c.default)(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),f=a("U7vG"),m=C(f),h=a("Zfgq"),y=a("4n+p"),v=a("d2xe"),g=a("zpSi"),w=a("fw66"),k=a("f2Hk"),E=a("NUeF"),_=(a("qeJi"),a("5qLU")),N=C(a("qAHI"));a("RYNs");var b=a("9F5X");function C(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,s.default)(t))&&"function"!=typeof t?e:t}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,l.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}var D={init:{url:_.WXAPI+"/user/shopOrder/list",method:"get"},del:{url:_.WXAPI+"/user/shopOrder/discard",method:"post"},conf:{url:_.WXAPI+"/user/shopOrder/confirmReceived",method:"post"}},I=(0,k.concatPageAndType)("tradeSearch"),A=(0,k.actionAxios)("tradeSearch"),L=function(t){function a(t){S(this,a);var n=H(this,(a.__proto__||(0,o.default)(a)).call(this,t));return n.btnClick=function(){var e=n.props,t=e.dispatch;e.status,e.location;if(""!==n.keyword.value){var a=n.keyword.value;t(I("keyword",{keyword:a})),document.title="搜索结果";t(A("getData",u({},D.init,{params:{page:1,page_size:10,status:"all",keyword:a}}),{type:"all",page:1})),n.addHistoryHandle(a)}else n.props.dispatch(I("ctrlPrompt",{prompt:{show:!0,msg:"请输入搜索词"}}))},n.addHistoryHandle=function(e){if(""===e.trim())return!1;var t=n.state.searchHistory;t=t||[];for(var a,o=0;a=t[o++];)a.word===e&&t.splice(o-1,1);t.unshift({word:e}),t.length>10&&(t.length=10);var l=(0,r.default)(t);window.localStorage.setItem("ordersearchHistory",l)},n.promptClose=function(){n.props.dispatch(I("ctrlPrompt",{prompt:{show:!1,msg:""}}))},n.modalClose=function(){n.props.dispatch(I("ctrlModal",{prompt:{show:!1,msg:"",modalSure:""}}))},n.handleEmail=function(t){e("#keywords").val(t)},n.clearHistory=function(){window.localStorage.removeItem("ordersearchHistory"),n.setState({searchHistory:[]})},n.state={keyword:"",list:[],searchHistory:[]},n}return O(a,f.Component),p(a,[{key:"componentWillMount",value:function(){var e=JSON.parse(window.localStorage.getItem("ordersearchHistory"));this.setState({searchHistory:e})}},{key:"componentWillUnmount",value:function(){this.props.resetData()}},{key:"render",value:function(){var t=this,a=this.props,r=a.dispatch,o=a.keyword;return m.default.createElement("div",{"data-page":"trade-search"},m.default.createElement("div",{className:"searchBox"},m.default.createElement("div",{className:"searchIpt"},m.default.createElement("span",{className:"searchIcon"}),m.default.createElement("input",{type:"search",placeholder:"商品名称",autoFocus:"autoFocus",id:"keywords",ref:function(e){return t.keyword=e}})),m.default.createElement("button",{className:"searchBtn",onClick:this.btnClick},"搜索")),m.default.createElement("div",{className:"list-main"},m.default.createElement("div",{"data-page":"trade-list",style:{overflow:"hidden",minHeight:e(window).height(),background:"#f8f8f8"}},m.default.createElement("section",{className:"trade-list",style:{paddingTop:60}},o?m.default.createElement(F,{status:"all",keyword:this.keyword}):m.default.createElement("div",{className:"history-block",style:{overflow:"hidden"}},m.default.createElement(P,{data:this.state.searchHistory,searchKeyWord:this.btnClick,dispatch:r,handleEmail:this.handleEmail.bind(this),clearHistory:this.clearHistory}))),m.default.createElement(w.PopupModal,{active:this.props.modal.show,msg:this.props.modal.msg,onClose:this.modalClose,onSure:this.props.modal.modalSure}),m.default.createElement(w.PopupTip,{active:this.props.prompt.show,msg:this.props.prompt.msg,onClose:this.promptClose}),m.default.createElement(w.ModalAComp,{active:this.props.custom.show,msg:"快去评论商品，给小伙伴一个参考吧",title:"确认收货成功！",btns:[{text:"下次再说",cb:function(){location.reload(),t.props.dispatch(I("ctrlCustom",{custom:{show:!1}}))}},{text:"立即评论",cb:function(){t.props.dispatch(I("ctrlCustom",{custom:{show:!1}})),h.browserHistory.push("/evaluateInput?tid="+t.props.custom.tid)}}]}))))}}]),a}(),P=function(e){function t(){var e,a,r;S(this,t);for(var n=arguments.length,l=Array(n),s=0;s<n;s++)l[s]=arguments[s];return a=r=H(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(l))),r.searchchildKeyWord=function(e){(0,r.props.dispatch)(I("keyword",{keyword:e.word})),r.props.handleEmail(e.word),r.props.searchKeyWord()},H(r,a)}return O(t,f.Component),p(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.data,r=t.clearHistory,o="历史搜索",n=!0;return m.default.createElement("div",{className:"search-key-list c-clrfix"},m.default.createElement("h3",null,m.default.createElement("span",null,o),n&&m.default.createElement("i",{className:"delete-box-icon",onClick:r}," ")),a&&a.length?m.default.createElement("div",{className:"search-key"},a.map(function(t,a){return m.default.createElement("div",{className:"grid-key",key:a,onClick:function(){e.searchchildKeyWord(t)}},m.default.createElement("span",null,t.word))})):m.default.createElement("div",{className:"search-null"},"暂无",o))}}]),t}(),x=function(e){function t(){return S(this,t),H(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return O(t,f.Component),p(t,[{key:"render",value:function(){return m.default.createElement("div",{className:"searchNull"},m.default.createElement("ul",null,m.default.createElement("li",{className:"searchNullIcon"}),m.default.createElement("li",{className:"searchNulNo"},"暂未找到相关订单哦~"),m.default.createElement(h.Link,{to:"/homeIndex"},m.default.createElement("li",null,"可以去商城逛逛>"))))}}]),t}(),M=function(e){function t(){return S(this,t),H(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return O(t,f.Component),p(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.count_goods,r=e.payment,o=e.platform,n=e.orderflag,l=e.swiper,s=t.shop_info,c=t.status,i=t.no,d=t.order_goods,u=t.consign_status,p=s.id,f=s.is_open,y=s.name,v=s.alias,g=s.shop_icon,w=t.order_goods.map(function(e,t){return m.default.createElement(b.GoodsList,{data:e,key:t})});return m.default.createElement("div",{className:"item-list"},m.default.createElement("div",{className:"order-info-time"},m.default.createElement("div",{className:"shop-name"},(0,E.storeIcon)(g),m.default.createElement("a",{href:1===f?"/store/home?shop="+p:"javascript:void(0)"},m.default.createElement("span",{className:"left"},v||y))),m.default.createElement("div",{className:"arrow-right"},m.default.createElement("a",null,1===f&&m.default.createElement("img",{src:"/src/img/icon/arrow/arrow-right-m-icon.png"}))),m.default.createElement("span",{className:"right order-status"},40==c?E.confimStatus[u]:E.ordersubStatusAndIconMap[c].status)),m.default.createElement(h.Link,{to:"/tradeDetail?tid="+i+"&orderflag="+n,className:"one-item"},w),m.default.createElement("div",{className:"order-count"},m.default.createElement("span",{className:"order-number"},"共",a,"件商品")," 合计：",m.default.createElement("span",{className:"order-total-pay"},"￥",(+r).toFixed(2))),m.default.createElement(j,{status:c,tid:i,platform:o,listStatus:this.props.listStatus,swiper:l,orderflag:n,order_goods:d,consign_status:u}))}}]),t}(),W=t.OneListInfo=function(e){function t(){return S(this,t),H(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return O(t,f.Component),p(t,[{key:"getHtml",value:function(){var e=this;return this.props.list.map(function(t,a){return m.default.createElement("li",{key:a,className:"one-order"},m.default.createElement("div",{className:"order-info"},m.default.createElement(M,{data:t,payment:t.payment,swiper:e.props.swiper,count_goods:t.order_goods.length,platform:t.order.platform_from,no:t.no,orderflag:2,listStatus:e.props.listStatus})))})}},{key:"render",value:function(){return m.default.createElement("div",{className:"list-data"},this.getHtml())}}]),t}(),R=(0,g.DropDownLoad)(W),T=function(t){function a(){var e,t,r;S(this,a);for(var n=arguments.length,l=Array(n),s=0;s<n;s++)l[s]=arguments[s];return t=r=H(this,(e=a.__proto__||(0,o.default)(a)).call.apply(e,[this].concat(l))),r.dropDown=function(e){var t=r.props,a=t.dispatch,o=t.page,n=t.total,l=t.keyword;if(o>=n)return e.lock(),e.noData(),void e.resetload();N.default.request(u({},D.init,{params:{page:Number(o)+1,page_size:10,status:"all",keyword:l}})).then(function(t){a(I("concatDataSuccess",{result:t.data,dataType:"all",page:Number(o)+1})),e.resetload()}).catch(function(t){throw e.resetload(),a(I("concatDataError",{error:t})),new Error(t)})},H(r,t)}return O(a,f.Component),p(a,[{key:"render",value:function(){var t=this.props,a=t.list,r=t.load;return m.default.createElement("div",{ref:"list",style:{overflow:"auto",height:document.body.clientHeight+30}},r?m.default.createElement(v.LoadingRound,null):a&&a.length?m.default.createElement(R,{scrollArea:e(this.refs.list),dropDown:this.dropDown,list:a,listStatus:"all"}):m.default.createElement(x,null))}}]),a}();var F=(0,y.connect)(function(e,t){return e.tradeSearch})(T),q=t.OrderCtrl=function(e){function t(){return S(this,t),H(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return O(t,f.Component),p(t,[{key:"getHtml",value:function(){var e=this,t=this.props,a=t.status,r=t.tid,o=t.platform,n=t.orderflag,l=t.canAfterSale,s=t.canFrim,c=t.consign_status,i="TR_WRD"!==o&&"catering"!==o,d=20==c,u="";switch(a){case 20:case 25:u=[l&&m.default.createElement(h.Link,{className:"ctrl-block",key:"1",to:"/tradeDetail?tid="+r+"&orderflag="+n},"申请售后")];break;case 40:u=[l&&m.default.createElement(h.Link,{className:"ctrl-block",key:"1",to:"/tradeDetail?tid="+r+"&orderflag="+n},"申请售后"),i&&m.default.createElement(h.Link,{className:"ctrl-red pay-order",key:"2",to:"/logistics?tid="+r},"查看物流"),m.default.createElement("a",{className:"ctrl-red pay-order",key:"3",onClick:function(){e.props.confirmReceipt(d,s)}},"确认收货")];break;case 50:u=[m.default.createElement("a",{className:"ctrl-block",key:"31",onClick:this.props.deleteOrder},"删除订单"),i&&m.default.createElement(h.Link,{className:"ctrl-red pay-order",key:"2",to:"/logistics?tid="+r},"查看物流"),m.default.createElement(h.Link,{className:"ctrl-red pay-order",key:"3",to:"/evaluateInput?tid="+r},"立即评价")];break;case 60:u=[i&&m.default.createElement(h.Link,{className:"ctrl-block",key:"2",to:"/logistics?tid="+r},"查看物流"),m.default.createElement("a",{className:"ctrl-block",key:"3",onClick:this.props.deleteOrder},"删除订单")];break;case 30:case 31:u=[m.default.createElement("a",{className:"ctrl-block",key:"43",onClick:this.props.deleteOrder},"删除订单")]}return u}},{key:"render",value:function(){return m.default.createElement("div",{className:"order-ctrl c-tr"},this.getHtml())}}]),t}();var j=(0,y.connect)(function(e,t){return{status:t.status}},function(e,t){var a=t.order_goods,r=void 0===a?[]:a;return{canAfterSale:r.some(function(e){return e.canAfterSale}),canFrim:r.some(function(e){return"售后中"===E.afterstatusDeal[e.afterSaleStatus]}),confirmReceipt:function(a,r){e(I("ctrlModal",{modal:{show:!0,msg:a?"订单存在未发货的商品，是否确认收货？":r?"订单存在售后中的商品，是否确认收货？":"是否要确认收货？",modalSure:function(){N.default.request(u({},D.conf,{data:{no:t.tid}})).then(function(a){setTimeout(function(){e(I("ctrlCustom",{custom:{show:!0,tid:t.tid}}))},1e3)}).catch(function(t){throw e(I("ctrlPrompt",{prompt:{show:!0,msg:t.response.data.message||"服务器繁忙！"}})),new Error(t)})}}}))},deleteOrder:function(){e(I("ctrlModal",{modal:{show:!0,msg:"确定删除该订单？删除后，您可在泰然城官网的订单回收站恢复",modalSure:function(){N.default.request(u({},D.del,{data:{no:t.tid}})).then(function(a){e(I("ctrlPrompt",{prompt:{show:!0,msg:a.data.message||"删除成功"}})),e(I("deleteOrder",{tid:t.tid,status:t.listStatus}))}).catch(function(t){throw e(I("ctrlPrompt",{prompt:{show:!0,msg:t.response.data.message||"服务器繁忙！"}})),console.log(t),new Error(t)})}}}))}}})(q);t.default=(0,y.connect)(function(e,t){return u({},e.tradeSearch,{status:t.params.status})},function(e,t){return{dispatch:e,resetData:function(){e(I("resetData"))}}})(L)}).call(this,a("OOjC"))}}]);