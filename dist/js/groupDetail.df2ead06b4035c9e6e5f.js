(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{"7vRm":function(e,t,a){},k9wu:function(e,t,a){"use strict";(function(e){var n=i(a("Zx67")),r=i(a("kiBT")),l=i(a("OvRC")),s=i(a("pFYg")),o=i(a("C4MV")),c=i(a("woOf"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=c.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,o.default)(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();t.stateModalData=K,t.stateModalDispatch=X;var m=a("U7vG"),p=x(m),f=a("Zfgq"),h=(x(a("O27J")),a("d2xe")),g=(a("fw66"),a("4n+p")),v=a("f2Hk"),y=a("6quk");a("7vRm");var _=a("JmOZ"),E=a("Wkbk"),k=a("f2t5"),N=x(a("qAHI")),b=a("qeJi"),M=a("5qLU");function x(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,s.default)(t))&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,l.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}var C={GroupBuy:{url:M.WXAPI+"/item/groupBuy",method:"get"},Promotion:{url:M.WXAPI+"/item/promotion",method:"get"},Recommend:{url:M.WXAPI+"/groupBuy/recommendItem",method:"get"}},D=(0,v.actionAxios)("itemIndex"),O=(0,v.concatPageAndType)("itemIndex"),L=function(e){function t(e,a){S(this,t);var r=w(this,(t.__proto__||(0,n.default)(t)).call(this,e));r.handleShady=function(){r.setState({shadyDefault:!r.state.shadyDefault})},r.handleShareModal=function(){r.setState({shareModal:!0})},r.goShare=function(){r.setState({shareModal:!0,shadyDefault:!0})};var l=e.location.query,s=l.object_id,o=l.user_id;return r.state={objectID:s,userId:o,update:!1,openMsg:!1,shadyDefault:!0,shareModal:!0,recommend:!1},r}return I(t,m.Component),d(t,[{key:"openOrClose",value:function(){this.setState({openMsg:!this.state.openMsg})}},{key:"componentWillMount",value:function(){document.title="拼团详情";var e=b.browser.versions,t=e.iPhone,a=e.iPad,n=e.weixin,r=location.href.split("#")[0];n&&!a&&!t&&(0,h.getJSApi)(r),this.state.objectID||f.browserHistory.push("/")}},{key:"componentDidMount",value:function(){var e=this,t=this.state.objectID,a=this.props.location.query.itemFlag,n=this;N.default.request(u({},C.GroupBuy,{params:{object_id:t}})).then(function(r){var l=r.data;if(0===l.code){var s=l.data;e.setState({dataList:s,update:!0}),a||e.props.Promotion(l);var o={title:l.data.item.title,desc:"我在泰然城发现了一个不错的商品，赶紧来看看吧！",link:location.protocol+"//"+location.host+"/groupDetail?object_id="+t,imgUrl:l.data.item.primary_image,type:"",dataUrl:"",success:function(){n.setState({shareModal:!1,shadyDefault:!0})},cancel:function(){}};(0,h.ShareConfig)(o),N.default.request(u({},C.Recommend,{params:{item_id:l.data.item.id}})).then(function(t){var a=t.data;0===a.code&&e.setState({recommendDataList:a,recommend:!0})})}else y.tip.show({msg:l.message})}).catch(function(e){console.log(e),y.tip.show({msg:e.response.data.message||"服务器繁忙"})})}},{key:"componentWillUnmount",value:function(){this.props.UpdateBuyModal({buyModal:!1})}},{key:"render",value:function(){var e=this.state,t=e.dataList,a=e.recommendDataList,n=e.update,r=e.openMsg,l=e.shadyDefault,s=e.shareModal,o=e.recommend,c=e.userId,i=this.props,d=i.promotion,m=i.proStatus,f=!1;if(t){var g=t.group.required_person-t.group.current_person,v=(new Date(t.group.expire_time.replace(/-/g,"/")).getTime()-new Date(t.group.now_time.replace(/-/g,"/")).getTime())/1e3,y=t.promotionData[0].status,_=t.is_open;g>0&&v>0&&y&&1===_&&(f=!0)}return n?p.default.createElement("div",{"data-page":"group-detail"},f&&l&&1===t.group.is_dealed?p.default.createElement(B,{data:t,fn1:this.handleShady,fn2:this.handleShareModal,goShare:this.goShare,shady:f,shareModal:s}):"",p.default.createElement("section",{id:"group-detail",ref:"group-detail"},p.default.createElement(P,{data:t,userId:c}),p.default.createElement(R,{data:t,fn:this.openOrClose.bind(this)}),r?p.default.createElement(G,{data:t}):"",p.default.createElement("div",{style:{height:15,backgroundColor:"#f4f4f4"}}),o?p.default.createElement(A,{data:a}):""),m&&p.default.createElement(Z,u({},this.props,{data:t,promotion:d,itemId:t.item.item_id}))):p.default.createElement(h.LoadingRound,null)}}]),t}(),B=function(t){function a(){return S(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return I(a,m.Component),d(a,[{key:"render",value:function(){var t=this.props,a=t.data,n=t.shady,r=t.shareModal;return n?p.default.createElement("div",{className:"shady",style:{height:e(window).height()}},r?p.default.createElement("div",null,p.default.createElement("img",{src:"/src/img/evaluate/hand.png",className:"hand"}),p.default.createElement(j,{data:a,fn:this.props.fn1})):p.default.createElement(q,{fn:this.props.fn2,goShare:this.props.goShare})):null}}]),a}(),j=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){var e=this.props.data,t=e.group.required_person-e.group.current_person;return p.default.createElement("div",{className:"group-msgb"},p.default.createElement(T,{data:e.group,timerStatus:!0}),p.default.createElement("div",{className:"c-cfff c-tc text"},p.default.createElement("img",{src:"/src/img/evaluate/un-done.png",className:"un-done"}),"ROOKIE_GROUP"===e.group.group_type?p.default.createElement("span",{className:"c-fs19"},"还差",p.default.createElement("span",{className:"c-cf44 c-fb c-fs24"},t)," ",p.default.createElement("span",{className:"c-cf44 c-fb c-fs20"}," 位新人")):p.default.createElement("span",{className:"c-fs19"},"还差",p.default.createElement("span",{className:"c-cdc c-fb c-fs24"},t),p.default.createElement("span",{className:"c-cdc c-fb c-fs20"},"人")),"拼团成功哦~快去邀请好友吧!"),p.default.createElement("img",{src:"/src/img/evaluate/okBtn.png",className:"btnImg",onClick:this.props.fn}))}}]),t}(),q=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){return p.default.createElement("div",{className:"share-success c-tc"},p.default.createElement("button",{className:"go-share",onClick:this.props.goShare},"继续分享"),p.default.createElement(f.Link,{to:"/"},p.default.createElement("button",{className:"go-home"},"返回首页")),p.default.createElement("img",{src:"/src/img/evaluate/close.png",className:"close",onClick:this.props.fn}))}}]),t}(),P=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.userId;return p.default.createElement("div",{className:"goods-msg"},p.default.createElement(f.Link,{to:a?"/item?item_id="+t.item.id+"&user_id="+a:"/item?item_id="+t.item.id},p.default.createElement("div",{className:"goods-img"},"ROOKIE_GROUP"===t.group.group_type?p.default.createElement("img",{className:"new-group",src:"/src/img/activity/new-group.png"}):"",p.default.createElement("img",{src:(0,k.addImageSuffix)(t.item.primary_image,"_s")}))),p.default.createElement("div",{className:"goods-detail"},p.default.createElement(f.Link,{to:"/item?item_id="+t.item.id},p.default.createElement("p",{className:"c-fs12 c-c35 c-lh16 goods-title",style:{display:"block",height:"48px"}},t.item.title)),p.default.createElement("p",{className:"c-fs12 c-c35"},t.group.required_person,"人团: ",p.default.createElement("span",{className:"c-fs16 c-cf55"},"¥",t.group.price))))}}]),t}(),R=function(t){function a(){return S(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return I(a,m.Component),d(a,[{key:"componentDidMount",value:function(){var t=e(this.refs.imgsBox).css("height");e(this.refs.groupImg).css({height:t})}},{key:"render",value:function(){var e=this.props.data,t=e.group.required_person-e.group.current_person,a=e.user.map(function(e,t){return p.default.createElement(F,{second:!t,isLeader:!1,key:t})});return p.default.createElement("div",{className:"group-msg c-bgf4"},p.default.createElement("div",{className:"c-c80 c-fs12 c-tc c-lh50"},1===e.group.is_dealed?"ROOKIE_GROUP"===e.group.group_type?p.default.createElement("span",null,"还差",p.default.createElement("span",{className:"c-cf44"},t,"位新人"),"拼团成功，快去邀请好友吧"):p.default.createElement("span",null,"还差",p.default.createElement("span",{className:"c-cf44"},t),"人,盼你如南方人盼暖气"):0===e.group.is_dealed?p.default.createElement("span",null,e.group.current_person,"人参团，拼团失败"):p.default.createElement("span",{className:"c-cf44"},e.group.required_person,"人参团，此团已完成")),p.default.createElement("div",{className:"group-img c-mb15",ref:"groupImg"},p.default.createElement("div",{className:"imgs-box c-tc",ref:"imgsBox"},p.default.createElement(F,{isLeader:!0}),a)),1===e.group.is_dealed&&p.default.createElement(T,{data:e.group}),p.default.createElement(U,{fn:this.props.fn}),1===e.group.is_dealed?"":p.default.createElement("img",{className:"success-of-fail",src:0===e.group.is_dealed?"/src/img/evaluate/group-fail.png":"/src/img/evaluate/group-success.png"}))}}]),a}(),F=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){var e=this.props,t=e.second,a=e.isLeader;return p.default.createElement("div",{className:"head-portrait"},p.default.createElement("div",{className:"portrait"},p.default.createElement("img",{src:"/src/img/icon/avatar/default-avatar.png"})),a||t?p.default.createElement("span",{className:"c-bgf44 c-cfff c-fs10 c-tc c-lh16",style:{backgroundColor:a?"#ff4444":"#ffc515"}},a?"团长":"沙发"):"")}}]),t}(),T=function(t){function a(){return S(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return I(a,m.Component),d(a,[{key:"componentWillMount",value:function(){var e=this.props.data,t=(new Date(e.expire_time.replace(/-/g,"/")).getTime()-new Date(e.now_time.replace(/-/g,"/")).getTime())/1e3,a=Math.floor(t/60/60),n=Math.floor((t-60*a*60)/60),r=Math.floor(t-60*a*60-60*n);this.setState({hh:a||0,mm:n||0,ss:r||0,mms:9})}},{key:"componentDidMount",value:function(){var t=this,a=this;this.timer=setInterval(function(){var n=a.state,r=n.hh,l=n.mm,s=n.ss,o=n.mms;if(0===r&&0===l&&0===s&&0===o)return clearInterval(t.timer),e(".remaining-time").css({display:"none"}),e(".shady").css({display:"none"}),void history.go(0);a.setState({mms:o-1}),o<1&&a.setState({mms:9,ss:s-1}),s<0&&a.setState({ss:59,mm:l-1}),l<0&&a.setState({mm:59,hh:r-1})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e=this.state,t=e.hh,a=e.mm,n=e.ss,r=e.mms;return this.props.timerStatus?p.default.createElement("div",{className:"timer1"},p.default.createElement("div",{className:" c-fs18 c-cfff c-tc"},"剩余 ",p.default.createElement("span",{className:"time"},t>9?t:"0"+t)," : ",p.default.createElement("span",{className:"time"},a>9?a:"0"+a)," : ",p.default.createElement("span",{className:"time",style:{position:"relative",width:"54px"}},p.default.createElement("span",{className:"mm"},n>9?n:"0"+n,"."),p.default.createElement("span",{className:"c-fs16 c-cdred mms"},r))," 结束")):p.default.createElement("div",{className:"remaining-time"},p.default.createElement("div",{className:"timer c-fs10 c-cfff c-tc c-bg35"},"距离结束仅剩 ",t>9?t:"0"+t,":",a>9?a:"0"+a,":",n>9?n:"0"+n))}}]),a}(),U=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"componentWillMount",value:function(){this.setState({isOpen:!1})}},{key:"openOrClose",value:function(){this.setState({isOpen:!this.state.isOpen}),this.props.fn()}},{key:"render",value:function(){var e=this.state.isOpen;return p.default.createElement("div",{className:"open-detail"},p.default.createElement("div",{onClick:this.openOrClose.bind(this),className:e?"open-txt open-txt-bg c-fs12 c-c80":"open-txt c-fs12 c-c80"},"查看全部参团详情"))}}]),t}(),G=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){var e=this.props.data,t=e.user.map(function(e,t){return p.default.createElement(W,{data:e,isLeader:!1,key:t})});return p.default.createElement("div",{className:"users-detail"},p.default.createElement("i",{className:"user-detail-arror"}," "),p.default.createElement("ul",null,p.default.createElement(W,{data:e.user_start[0],isLeader:!0}),t))}}]),t}(),W=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"getDate",value:function(e){var t=new Date(e);return(t.getFullYear()>9?t.getFullYear():"0"+t.getFullYear())+"-"+(t.getMonth()+1>9?t.getMonth()+1:"0"+(t.getMonth()+1))+"-"+(t.getDate()>9?t.getDate():"0"+t.getDate())+" "+(t.getHours()>9?t.getHours():"0"+t.getHours())+":"+(t.getMinutes()>9?t.getMinutes():"0"+t.getMinutes())+":"+(t.getSeconds()>9?t.getSeconds():"0"+t.getSeconds())}},{key:"render",value:function(){var e=this.props,t=e.isLeader,a=e.data,n=t?a.open_time:a.join_time;return p.default.createElement("li",{className:t?"c-bgf99 c-mb10":"c-bgc9 c-mb10"},p.default.createElement("span",{className:t?"c-bgf99 horn":"c-bgc9 horn"}),p.default.createElement("span",{className:"circle c-bgf44"}),p.default.createElement("div",{className:"portrait"},p.default.createElement("img",{src:"/src/img/icon/avatar/default-avatar.png"})),t?p.default.createElement("div",{className:"c-cfff c-fl c-fs12 c-lh46",style:{paddingRight:"4px"}},"团长"):"",p.default.createElement("p",{className:"c-fl c-cfff c-lh46"},a.name),p.default.createElement("p",{className:"c-fr c-cfff c-lh46"},t?"开团":"参团"),p.default.createElement("div",{className:"c-fr c-cfff c-lh46",style:{paddingRight:"2px"}},n))}}]),t}(),A=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){var e=this.props.data.data.data.map(function(e,t){if(t<9)return p.default.createElement(H,{data:e,key:t})});return p.default.createElement("div",{className:"group-recommend"},p.default.createElement("p",{className:"c-fs14 recommend-title"},"拼团推荐"),p.default.createElement("div",{className:"recommend-goods"},e),p.default.createElement("div",{className:"recommend-footer"},p.default.createElement(f.Link,{to:"/groupHome"},p.default.createElement("span",{style:{color:"#999999"}},"拼团商城")),p.default.createElement("i",null," "),p.default.createElement(f.Link,{to:"/groupList/0"},p.default.createElement("span",{style:{color:"#999999"}},"我的拼团"))))}}]),t}(),H=function(e){function t(){return S(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return I(t,m.Component),d(t,[{key:"render",value:function(){var e=this.props.data,t=String(parseFloat(e.sell_price)).split(".")[0],a=String(parseFloat(e.sell_price)).split(".")[1];return p.default.createElement("div",{className:"c-tc each-goods"},p.default.createElement("div",{style:{width:"96%",maxWidth:105,display:"inline-block"}},p.default.createElement("div",{style:{height:105,overflow:"hidden"}},p.default.createElement(f.Link,{to:"/item?item_id="+e.item_id},p.default.createElement("img",{src:(0,k.addImageSuffix)(e.images[0],"_s")||"/src/img/icon/loading/default-no-item.png"}))),p.default.createElement("div",{className:"c-fs12 c-tl"},p.default.createElement("p",{className:" c-c35 title"},e.title),a>0?p.default.createElement("p",{className:"recommend-price c-fs15"},p.default.createElement("span",{className:"c-fs12"},"¥"),t+".",p.default.createElement("span",{className:"c-fs12"},a)):p.default.createElement("p",{className:"recommend-price c-fs15"},p.default.createElement("span",{className:"c-fs12"},"¥"),t))))}}]),t}(),J=[];J[5]={text:"活动已过期",clsFix:"color-grey",click:null},J[8]={text:"已售罄",clsFix:"color-grey",click:null},J[0]={text:"暂不销售",clsFix:"color-grey",click:null},J[1]={text:"我也开个团",click:"showModal",activeType:"groupBuy"},J[2]={text:"重新开团",click:"showModal",activeType:"groupBuy"},J[3]={text:"分享",click:"BUY"},J[4]={text:"确定参团",click:"showModal",activeType:"joinGroup"},J[6]={text:"参与次数到上限",clsFix:"color-grey",click:null},J[10]={text:"开团已达上限",clsFix:"color-grey",click:null},J[7]={text:"登录后参团",click:null},J[9]={text:"仅限新人参团",clsFix:"color-grey",click:null};var Y=function(e){function t(){var e,a,r;S(this,t);for(var l=arguments.length,s=Array(l),o=0;o<l;o++)s[o]=arguments[o];return a=r=w(this,(e=t.__proto__||(0,n.default)(t)).call.apply(e,[this].concat(s))),r.showModal=function(){r.props.UpdateBuyModal({buyModal:!0})},r.closeModal=function(){r.props.UpdateBuyModal({buyModal:!1})},w(r,a)}return I(t,m.Component),d(t,[{key:"componentWillMount",value:function(){var e=J[this.getGroupState()];this.state={groupState:e}}},{key:"getGroupState",value:function(){var e=this.props,t=e.data,a=e.data,n=a.item,r=a.is_open,l=e.promotion.realStore,s=t.group.required_person-t.group.current_person,o=(new Date(t.group.expire_time.replace(/-/g,"/")).getTime()-new Date(t.group.now_time.replace(/-/g,"/")).getTime())/1e3;return"SHELVING"!==n.status?0:0===l?8:"GroupBuy"!==t.item_type?5:this.props.isLogin?o<=0||s<=0?1===r?2:1:1===r?2:4:7}},{key:"bindClick",value:function(e){e.click&&this[e.click]()}},{key:"render",value:function(){var e=this,t=this.props.data,a=t.item,n=t.group,r=t.is_open,l={primary_image:a.primary_image,tax_rate:a.tax,trade_type:a.trade_type,object_id:1===n.is_dealed?1===r?0:this.props.location.query.object_id:0,groupPrice:n.price,shop_id:a.shop_id,shop:a.shop},s=u({},this.props,this.state,{itemId:this.props.data.item.id,data:l,closeModal:this.closeModal}),o=this.state.groupState;return p.default.createElement("section",{className:"group-purchase-btn"},p.default.createElement(E.BuyModal,u({},s,{active:o.activeType})),p.default.createElement(f.Link,{className:"more-pintuan",to:"/groupHome"},p.default.createElement("span",{className:"list-icon"},p.default.createElement("img",{src:"/src/img/pintuan/white-home.png"})),"更多拼团"),p.default.createElement(_.LinkChange,{className:"jump-group-btn sure-join-group "+(o.clsFix||" "),onClick:function(){e.bindClick(o)}},o.text))}}]),t}();function K(e){return{promotion:e.itemIndex.promotion,retState:e.itemIndex.retState,buyModal:e.itemIndex.buyModal,buyActive:e.itemIndex.buyActive,proStatus:e.itemIndex.proStatus,areaData:e.itemIndex.areaData}}function X(e){return{Promotion:function(t){e(D("promotionData",u({},C.Promotion,{params:{item_id:t.data.item.id}})))},UpdateBuyModal:function(t){e(O("updateBuyModal",t))},InitState:function(t){e(O("initState",{ret:t}))}}}var Z=(0,g.connect)(function(e){return u({},e.global)})(Y);t.default=(0,g.connect)(K,X)(L)}).call(this,a("OOjC"))}}]);