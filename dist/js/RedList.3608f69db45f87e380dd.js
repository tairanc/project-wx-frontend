(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{PsRS:function(e,t,a){"use strict";(function(e){var n=c(a("Zx67")),l=c(a("kiBT")),r=c(a("OvRC")),s=c(a("pFYg")),o=c(a("C4MV")),u=c(a("woOf"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=u.default||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,o.default)(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),f=a("U7vG"),p=y(f),m=(y(a("O27J")),a("Zfgq")),h=a("d2xe"),g=(a("fw66"),y(a("4GUf"))),v=y(a("qAHI")),_=(a("f2t5"),a("5qLU"));function y(e){return e&&e.__esModule?e:{default:e}}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,s.default)(t))&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(l.default?(0,l.default)(e,t):e.__proto__=t)}a("kwLB");var b={getRedList:{url:_.WXAPI+"/promotion/getRedPacketList"}},M=function(t){function a(e){E(this,a);var t=w(this,(a.__proto__||(0,n.default)(a)).call(this,e));return t.getMsg=function(e){var a=t;a.setState({status:e,listUpdate:!1,page:2}),v.default.request(i({},b.getRedList,{params:{status:e,page:1,page_size:10}})).then(function(t){var n=t.data;0===n.code?a.setState({redData:n.data.red_packet.data,hasMore:n.data.red_packet.data.length>=10,update:!0,listUpdate:!0,type:e,rule:n.data.red_packet.rule_text}):(g.default.MsgTip({msg:"服务器繁忙"}),a.setState({sending:!1}))}).catch(function(e){e.response&&e.response.data.code?m.browserHistory.replace("/login?redirect_uri=%2FcouponList"):(console.log("Error",e.message),g.default.MsgTip({msg:"服务器繁忙"}))})},t.addMsg=function(e){var a=t;t.setState({sending:!0}),v.default.request(i({},b.getRedList,{params:{status:e,page:t.state.page,page_size:10}})).then(function(e){var t=e.data;0===t.code?a.setState({redData:a.state.redData.concat(t.data.red_packet.data),hasMore:t.data.red_packet.data.length>=10,sending:!1,page:a.state.page+1}):(g.default.MsgTip({msg:"服务器繁忙"}),a.setState({sending:!1}))}).catch(function(e){console.log("Error",e.message),g.default.MsgTip({msg:"服务器繁忙"}),a.setState({sending:!1})})},t.state={countData:{},redData:[],update:!1,listUpdate:!1,showStatus:!1,page:2,hasMore:!0,sending:!1,rule:"",type:1,status:1},t}return k(a,f.Component),d(a,[{key:"componentWillMount",value:function(){document.title="红包"}},{key:"componentDidMount",value:function(){this.getMsg(1)}},{key:"render",value:function(){var t=this.state,a=t.countData,n=t.redData,l=(t.showStatus,t.hasMore),r=t.sending,s=t.rule,o=t.type,u=t.status;return this.state.update?p.default.createElement("div",{"data-page":"red-list",style:{minHeight:e(window).height()}},p.default.createElement("section",{id:"red-list"},p.default.createElement(N,{data:a,fn:this.getMsg}),p.default.createElement(D,{data:s}),this.state.listUpdate?p.default.createElement(C,{fn:this.addMsg,data:n,hasMore:l,sending:r,type:o,status:u}):p.default.createElement(h.LoadingRound,null))):p.default.createElement(h.LoadingRound,null)}}]),a}();t.default=M;var N=function(t){function a(){return E(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return k(a,f.Component),d(a,[{key:"componentDidMount",value:function(){var t=this.props.fn;e(".red-nav li").click(function(a){if("active-one"===e(this).attr("class"));else{e(this).addClass("active-one").siblings().removeClass("active-one");var n=parseInt(e(".active-one").attr("id"));t(n)}})}},{key:"render",value:function(){return p.default.createElement("ul",{className:"red-nav c-c35 c-tc c-fs14"},p.default.createElement("li",{className:"active-one",id:"1"},p.default.createElement("span",null,"有效红包")),p.default.createElement("li",{id:"0"},p.default.createElement("span",null,"失效红包")))}}]),a}(),D=function(e){function t(){return E(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return k(t,f.Component),d(t,[{key:"componentWillMount",value:function(){this.setState({showRules:!1})}},{key:"render",value:function(){var e=this,t=this.props.data;return p.default.createElement("div",{className:"rule"},p.default.createElement("button",{className:"open-btn",onClick:function(){e.setState({showRules:!0})}},"使用规则"),this.state.showRules?p.default.createElement("div",{className:"cover"},p.default.createElement("div",{className:"rule-box c-tc c-pr"},p.default.createElement("h3",null,"使 用 规 则"),p.default.createElement("ul",{className:"rule-content c-fs10 c-tl c-mb20"},t.split("\n").map(function(e,t){return p.default.createElement("li",{key:t},e)})),p.default.createElement("button",{className:"rule-btn c-fs18 c-cfff",onClick:function(){e.setState({showRules:!1})}},"知道了"),p.default.createElement("div",{className:"rule-close c-pa"},p.default.createElement("button",{onClick:function(){e.setState({showRules:!1})}})))):"")}}]),t}(),C=function(t){function a(){return E(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return k(a,f.Component),d(a,[{key:"componentDidMount",value:function(){var t=parseInt(e(".active-one").attr("id"));this.setState({type:t})}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.type,n=e.hasMore,l=e.fn,r=e.sending,s=e.status,o=t.filter(function(e){return 3===e.type}).map(function(e,t){return p.default.createElement(x,{key:t,data:e,type:a,status:s})});return p.default.createElement("div",{className:"list-contrl"},p.default.createElement("div",{className:"each-list"},o.length?o:p.default.createElement(S,null)),!!o.length&&p.default.createElement(P,{type:a,fn:l,hasMore:n,sending:r}))}}]),a}(),S=function(e){function t(){return E(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return k(t,f.Component),d(t,[{key:"render",value:function(){return p.default.createElement("div",{className:"no-red"},p.default.createElement("img",{src:"./src/img/channels/no-red.png"}))}}]),t}(),x=function(t){function a(){var e,t,l;E(this,a);for(var r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];return t=l=w(this,(e=a.__proto__||(0,n.default)(a)).call.apply(e,[this].concat(s))),l.getDate=function(e){var t=new Date(1e3*parseInt(e));return t.getFullYear()+"/"+(parseInt(t.getMonth())+1)+"/"+t.getDate()},l.closePopup=function(){l.setState({showPop:!1})},l.formateDate=function(e){var t=e.split(" ");return t[0].split("-").join("/").substring(2)+" "+t[1].substring(0,5)},l.getTime=function(e){return new Date(e.replace(/-/g,"/")).getTime()},l.getRedStatus=function(){var e=l.props,t=e.data,a=t.use_start_time,n=t.current_time;return e.status?l.getTime(n)>l.getTime(a)?"valid":"ineffective":"invalid"},w(l,t)}return k(a,f.Component),d(a,[{key:"componentWillMount",value:function(){this.setState({showPop:!1,isIphone5:!1})}},{key:"componentDidMount",value:function(){e(window).width()<330&&this.setState({isIphone5:!0})}},{key:"render",value:function(){var e=this,t={valid:{text:"已生效",classType:""},ineffective:{text:"未生效",classType:"each-red-not"},invalid:{text:"已失效",classType:"each-red-invalid"}},a=this.props,n=a.data,l=(a.type,this.formateDate(n.use_start_time)),r=this.formateDate(n.use_end_time),s=this.getRedStatus();return p.default.createElement("div",{className:"each-red "+t[s].classType},p.default.createElement("div",{className:"top"},p.default.createElement("div",{className:"price c-fs20 c-cdred c-tc c-fl"},"¥",p.default.createElement("span",{className:n.deduct_money<100?"c-fs45":"c-fs30"},n.deduct_money)),p.default.createElement("div",{className:"red-msg c-fl c-pr"},p.default.createElement("span",{className:"red-status c-cblue c-fs11 c-pa"},t[s].text),p.default.createElement("p",{className:"c-fs16"}," ",n.name),"ALL"!==n.applicable_item_type&&p.default.createElement("p",{className:"c-fs11 c-c999"},"· ",n.apply_text),"ALL"!==n.applicable_platform&&p.default.createElement("p",{className:"c-fs11 c-c999"},"· ",n.applicable_platform+"端专用"))),p.default.createElement("div",{className:"bottom"},p.default.createElement("span",{className:"c-fl c-c999"},"有效期: ",p.default.createElement("em",null,l),"至",p.default.createElement("em",null,r)),this.state.isIphone5?p.default.createElement("button",{className:"c-fr small-screen",onClick:function(){e.setState({showPop:!0})}},"更多"):p.default.createElement("button",{className:"c-fr",onClick:function(){e.setState({showPop:!0})}},"查看更多")),this.state.showPop&&p.default.createElement(T,{fn:this.closePopup,data:n}))}}]),a}(),T=function(t){function a(){return E(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return k(a,f.Component),d(a,[{key:"componentDidMount",value:function(){setTimeout(function(){e(".pop-up").addClass("box-up")},100)}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.fn,n=t.use_records.map(function(e,a){return p.default.createElement(L,{data:e,money:t.deduct_money,key:a})});return p.default.createElement("div",null,p.default.createElement("div",{className:"box",onClick:function(){a()}}),p.default.createElement("div",{className:"pop-up c-pr"},p.default.createElement("button",{onClick:function(){a()}}),p.default.createElement("h3",null,t.coupon_name),t.use_records.length?p.default.createElement("div",{style:{borderTop:"1px solid #e4e4e4",height:"240px",overflowY:"scroll"}},n):p.default.createElement(R,null)))}}]),a}(),R=function(e){function t(){return E(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return k(t,f.Component),d(t,[{key:"render",value:function(){return p.default.createElement("div",{className:"no-records"},p.default.createElement("img",{src:"./src/img/channels/no-record.png"}))}}]),t}(),L=function(e){function t(){return E(this,t),w(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return k(t,f.Component),d(t,[{key:"getDate",value:function(e){var t=new Date(1e3*e);return(t.getFullYear()>9?t.getFullYear():"0"+t.getFullYear())+"-"+(t.getMonth()+1>9?t.getMonth()+1:"0"+(t.getMonth()+1))+"-"+(t.getDate()>9?t.getDate():"0"+t.getDate())+" "+(t.getHours()>9?t.getHours():"0"+t.getHours())+":"+(t.getMinutes()>9?t.getMinutes():"0"+t.getMinutes())}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.money,n=t.used_time?t.used_time:t.cancel_time?t.cancel_time:t.expire_time;return p.default.createElement("div",{className:"one-record c-pr"},p.default.createElement("p",{className:"c-fs12 c-c35"},t.expire_time?"过期失效":"订单号"+t.order_id+" "+(t.used_time?"下单使用":"取消使用")),p.default.createElement("p",{className:"c-fs10 c-c999"},n),p.default.createElement("span",{className:"c-fs20 c-cdred c-pa",style:{top:"14px",right:"15px"}},(t.cancel_time?"+ ¥":"- ¥")+a))}}]),t}(),P=function(t){function a(){return E(this,a),w(this,(a.__proto__||(0,n.default)(a)).apply(this,arguments))}return k(a,f.Component),d(a,[{key:"componentWillUnmount",value:function(){e(window).unbind("scroll.loadmore")}},{key:"componentDidMount",value:function(){var t=this.props.fn,a=parseInt(e(".active-one").attr("id")),n=this;e(window).bind("scroll.loadmore",function(){e(this).scrollTop()>=e(".list-contrl").height()-e(window).height()&&n.props.hasMore&&!n.props.sending&&t(a)})}},{key:"render",value:function(){var e=this.props,t=e.hasMore,a=e.sending,n=e.type;return p.default.createElement("div",{className:"no-more"},p.default.createElement("div",{className:"line c-pr"}),p.default.createElement("div",{className:"txt c-c999 c-tc c-fs14"},t?a?"加载中...":"下拉加载更多":2===n?"仅保留90天内的记录":"别拉了，我是有底线的~"))}}]),a}()}).call(this,a("OOjC"))},kwLB:function(e,t,a){}}]);