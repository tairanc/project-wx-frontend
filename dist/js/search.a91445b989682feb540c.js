(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{E95e:function(e,t,r){"use strict";(function(e){var a=u(r("mvHQ")),o=u(r("Zx67")),n=u(r("kiBT")),i=u(r("OvRC")),c=u(r("pFYg")),l=u(r("C4MV")),s=u(r("woOf"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d,p=s.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},h=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,l.default)(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),f=r("U7vG"),m=(d=f)&&d.__esModule?d:{default:d},y=r("4n+p"),g=r("Zfgq"),v=r("d2xe"),w=r("f2Hk"),H=r("fw66"),b=r("qeJi");function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,c.default)(t))&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,c.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}r("SFZ9");var _={completion:{url:"/wxapi/search/auto-complete",method:"get"},hot:{url:"/wxapi/search/hotwords",method:"get",params:{terminal:3}},placeHolder:{url:"/wxapi/search/placeholder",method:"get",params:{terminal:3}}},C=(0,w.actionAxios)("searchIndex"),S=(0,w.concatPageAndType)("searchIndex"),N=function(t){function r(){var t,n,i;k(this,r);for(var c=arguments.length,l=Array(c),s=0;s<c;s++)l[s]=arguments[s];return n=i=x(this,(t=r.__proto__||(0,o.default)(r)).call.apply(t,[this].concat(l))),i.getTerraceHost=function(){var e="m";return navigator.userAgent.indexOf("51gjj")>-1?e="51af-m":"mall"==document.cookie.platform?e="m":"finance"==document.cookie.platform?e="jr-m":document.cookie.origin||(e="wx"),e},i.getLinkByTerrace=function(e){return e&&e.indexOf("tairanmallhost")>-1?e.replace("tairanmallhost",i.getTerraceHost()):e},i.searchSubmit=function(e,t,r){(e=void 0!==e?e.trim():"")?t?window.location.href=i.getLinkByTerrace(t):(i.addHistoryHandle(e),g.browserHistory.replace("/searchResult?key="+encodeURIComponent(e)+(r&&r.shop?"&shop="+r.shop:"")+(r&&r.coupon_id?"&coupon_id="+r.coupon_id:""))):i.props.dispatch(S("ctrlPrompt",{prompt:{show:!0,msg:"请输入搜索词"}}))},i.addHistoryHandle=function(e){if(!e)return!1;for(var t,r=i.props,o=r.searchHistory,n=r.dispatch,c=0;t=o[c++];)t.word===e&&o.splice(c-1,1);o.unshift({word:e}),o.length>20&&(o.length=20);var l=(0,a.default)(o);window.localStorage.setItem("searchHistory",l),n(S("historyCtrl",{history:o}))},i.clearHistory=function(){window.localStorage.removeItem("searchHistory"),i.props.dispatch(S("historyCtrl",{history:[]}))},i.searchHandle=function(e){i.props.dispatch(S("keyCtrl",{key:e})),""!==e.trim()?i.xhrHandle(i.deleteSpace(e)):i.props.dispatch(S("listCtrl",{list:[]}))},i.getList=function(){return i.props.compList&&i.props.compList.map(function(e,t){return m.default.createElement(T,{key:t,text:e.text,accurate:e.accurate,clickHandle:e.accurate?e.clickHandle:i.searchSubmit.bind(null,e.text)})})},i.deleteSpace=function(e){if("string"==typeof e){e=e.trim();for(var t="",r=0;r<e.length;r++)t+=" "==e[r]?"":e[r];return t}return e},i.searchBarMount=function(t){var r=i.deleteSpace(t);""!==r&&i.props.searchCompletion(r),setTimeout(function(){e(i.refs.search).focus()},0)},x(i,n)}return E(r,f.Component),h(r,[{key:"componentWillMount",value:function(){this.props.initialPage(),this.props.updateHot(),this.props.initPlaceHolder(),this.xhrHandle=(0,b.throttle)(this.props.searchCompletion)}},{key:"render",value:function(){var e=this.props,t=e.keyWord,r=e.param,a=e.placeHolder,o=e.searchHistory,n=e.hotList,i=e.prompt,c=e.promptClose;e.compList;return m.default.createElement("div",{"data-page":"search-page",id:"searchPage"},m.default.createElement("div",{style:{borderBottom:"1px solid #e4e4e4"},className:"search-bar-grid"},m.default.createElement(v.SearchBarA,{ref:"search",onChange:this.searchHandle,value:t,param:r,isMount:this.searchBarMount.bind(null,t),onSearch:this.searchSubmit,placeHolder:a})),t?r.shop||r.coupon_id?"":m.default.createElement("div",{className:"search-list-grid"},m.default.createElement("div",{className:"search-list"},this.getList())):m.default.createElement("div",{className:"history-block"},m.default.createElement(P,{type:"history",data:o,param:r,clearHistory:this.clearHistory,searchKeyWord:this.searchSubmit}),m.default.createElement(P,{type:"hotWord",data:n,param:r,searchKeyWord:this.searchSubmit})),m.default.createElement(H.PopupTip,{active:i.show,msg:i.msg,onClose:c}))}}]),r}(),P=function(e){function t(){return k(this,t),x(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return E(t,f.Component),h(t,[{key:"render",value:function(){var e=this.props,t=e.type,r=e.data,a=e.searchKeyWord,o=e.param,n={history:{text:"历史搜索",del:!0},hotWord:{text:"热门搜索",del:!1}},i=r&&r.length?m.default.createElement("div",{className:"search-key"},r.slice(0,10).map(function(e,t){return m.default.createElement("div",{className:"grid-key",key:t,onClick:function(t){a(e.word,e.link,o)}},m.default.createElement("div",{className:e.highlight?"red-btn":"black-btn"},m.default.createElement("div",null,e.word)))})):m.default.createElement("div",{className:"no-history"},"暂无",n[t].text);return m.default.createElement("div",{className:"search-key-list c-clrfix"},m.default.createElement("h3",null,m.default.createElement("span",null,n[t].text),n[t].del&&m.default.createElement("i",{className:"delete-box-icon",onTouchTap:this.props.clearHistory}," ")),i)}}]),t}(),T=function(e){function t(){return k(this,t),x(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return E(t,f.Component),h(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.text,a=t.accurate;return m.default.createElement("div",{className:"list-one c-clrfix",onClick:function(){return e.props.clickHandle()}},m.default.createElement("div",{className:"c-fl c-dpb grid-left g-col-1"},r),a?m.default.createElement("div",{className:"c-fr c-dpb grid-right"},a,m.default.createElement("i",{className:"arrow-right-icon"}," ")):"")}}]),t}();t.default=(0,y.connect)(function(e,t){return p({},e.searchIndex)},function(e,t){return{dispatch:e,promptClose:function(){e(S("ctrlPrompt",{prompt:{show:!1,msg:""}}))},initialPage:function(){try{var t=window.localStorage.getItem("searchHistory");t&&(t=JSON.parse(t),e(S("historyCtrl",{history:t})))}catch(e){console.error(error)}},initPlaceHolder:function(){e(C("initPlaceHolder",_.placeHolder))},updateHot:function(){e(C("updateHot",_.hot))},searchCompletion:function(t){e(C("searchCpt",p({},_.completion,{params:{keyword:t}}),t))}}})(N)}).call(this,r("OOjC"))},SFZ9:function(e,t,r){}}]);